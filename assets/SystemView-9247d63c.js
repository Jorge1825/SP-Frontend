import{l as W,s as j,g as r,x as de,r as y,o as S,c as Y,a as i,C as Z,t as ee,d as n,a4 as Ie,_ as Oe,m as De,q as Re,v as Ce,f as ue,y as Te,w as p,h as s,i as D,M as ze,j as N,F as Ne,z as b,A as ie,E as K,a5 as Pe,B as ce,p as Be,e as Le,R}from"./index-3a09a4c6.js";import{B as Me}from"./ButtonAdd-4b004f79.js";const Fe=async o=>{try{const d=W(),{data:l}=await j.get("/users",{headers:{token:d,farm:o}});return l}catch(d){return d}},We=async(o,d)=>{try{const l=W(),{data:m}=await j.post("/users/register",{name:o.name,tpdocument:o.tpdocument,numdocument:o.numdocument,role:o.role,farms:[o.farms],email:o.email,password:o.password},{headers:{token:l,farm:d}});return m}catch(l){return l}},je=async(o,d)=>{try{const l=W(),{data:m}=await j.put(`/users/update/${o.id}`,{name:o.name,tpdocument:o.tpdocument,numdocument:o.numdocument,role:o.role,farms:[o.farms],email:o.email,password:o.password},{headers:{token:l,farm:d}});return m}catch(l){return l}},Ge=async(o,d)=>{try{const l=W(),{data:m}=await j.put(`/users/inactive/${o}`,{},{headers:{token:l,farm:d}});return m}catch(l){return l}},Xe=async(o,d)=>{try{const l=W(),{data:m}=await j.put(`/users/active/${o}`,{},{headers:{token:l,farm:d}});return m}catch(l){return l}},$e=["for"],He={class:"text-red"},Qe={__name:"Email",props:{label:{type:String,required:!0},styles:{type:Object,required:!1},required:{type:Boolean,required:!1,default:!1},value:{required:!1,default:""}},emits:{onEmail:null},setup(o,{emit:d}){const l=o,m=r(l.value),L=[f=>f?f.match(/^\w+([.-_+]?\w+)*@\w+([.-]?\w+)*(\.\w{2,10})+$/)?!0:"El email no es valido":"Email requerido"];return de(m,()=>{d("onEmail",m.value)}),(f,g)=>{const M=y("q-input");return S(),Y("div",{style:Ie(l.styles)},[i("span",{for:l.label},[Z(ee(l.label),1),i("span",He,ee(l.required?"*":""),1)],8,$e),n(M,{modelValue:m.value,"onUpdate:modelValue":g[0]||(g[0]=x=>m.value=x),dense:"",filled:"",name:l.label,rules:L,type:l.type},null,8,["modelValue","name","type"])],4)}}};const ae=o=>(Be("data-v-d5e9ede2"),o=o(),Le(),o),Je={class:"q-py-md table-container"},Ke=ae(()=>i("h6",{class:"title q-my-lg"},"ACCESO AL SISTEMA",-1)),Ye={class:"container-content"},Ze={class:"container-table q-mt-md q-pa-md",rounded:""},ea={class:"accions-td"},aa={class:"accions-td"},ta=ae(()=>i("i",{class:"icon icon-check"},null,-1)),la={class:"modalSystem"},oa={class:"q-my-md text-center"},sa={class:"row q-px-xl"},na={class:"col-12"},ra={class:"row justify-between"},ua=ae(()=>i("span",{class:"text-required q-py-sm"},[Z("Todos los campos con "),i("span",{class:"text-red"},"*"),Z(" son obligatorios")],-1)),ia={class:"row justify-center q-mt-sm"},ca={key:4,class:"spinner"},da={__name:"SystemView",setup(o){const d=De(),l=Re(),m=r(),L=r(""),f=r(!1),g=r(!1),M=r(!0),x=r([]),F=r([]),me=Ce();let G=r(""),X=r(""),$=r(""),C=r(""),H=r(""),Q=r(""),q=r(""),w=r(""),h=r(""),A=r(""),E=r(""),U=r(""),I=r(""),V=r(""),O=r("active");const te=ue(()=>!q.value||!w.value||!h.value||!E.value||!U.value||!I.value||!A.value?!0:g.value==!0),T=[e=>!!e||"Este campo es requerido"],le=r([{name:"id",label:"#",field:"id",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"Nombre",label:"Nombre",field:"name",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"Tipo",label:"Tipo",field:"tpdocument",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"Documento",label:"Documento",field:"numdocument",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"email",label:"Correo Electronico",field:"email",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"role",label:"Rol",field:"role",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"Acciones",label:"Acciones",field:"acciones",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"}]),ve=e=>{q.value=e},pe=e=>{w.value=e},fe=e=>{h.value=e},ye=e=>{A.value=e},_e=e=>{E.value=e},ge=e=>{U.value=e},be=e=>{I.value=e},Se=()=>{L.value="REGISTRAR ACCESO",qe(),M.value=!0,l.toggleModal()},qe=()=>{G.value="",X.value="",$.value="",C.value="",H.value="",Q.value="",q.value="",w.value="",h.value="",E.value="",U.value="",I.value="",A.value=""},we=e=>{L.value="EDITAR TIPO DE PAGO",M.value=!1,m.value=e._id,G.value=e.name,X.value=e.tpdocument,$.value=e.numdocument,C.value=e.role,H.value=e.farms,Q.value=e.email,q.value=e.name,w.value=e.tpdocument,h.value=e.numdocument,E.value=e.role,U.value=e.email,l.toggleModal()},u=(e,t)=>{d.notify({type:e,message:t,position:"top"})};async function P(){x.value=[],F.value=[],f.value=!0;try{const e=await Fe(B.value);let t=1,k=1;e.forEach(c=>{c.status=c.status?"Inactivo":"Activo",c.status=="Activo"?(c.id=t++,x.value.push(c)):(c.id=k++,F.value.push(c))}),f.value=!1}catch{u("negative","Ocurrió un error al obtener los usuarios")}}async function he(){var k,c,z;g.value=!0;let e=A.value,t=[];e.forEach(v=>{t.push(v._id)});try{const v=await je({id:m.value,name:q.value,tpdocument:w.value,numdocument:h.value,role:E.value,farms:t,email:U.value,password:I.value},B.value);g.value=!1;let _=(z=(c=(k=v==null?void 0:v.response)==null?void 0:k.data)==null?void 0:c.errors[0])==null?void 0:z.msg;_==R.USEREXIST?u("negative","El usuario ya existe"):_==R.LENGTHPASSWORD?u("negative","La contraseña debe tener de 6 a 20 carácteres"):_==R.RULESPASSWORD?u("negative","La contraseña debe tener una letra mayúscula, una letra minúscula y un número"):_==R.EMAILEXIST?u("negative","El email ya esta registrado"):(u("positive","Tipo de pago actualizado correctamente"),l.toggleModal(),x.value=[],P())}catch{g.value=!1,u("negative","Ocurrió un error")}}async function Ee(){var k,c,z;g.value=!0;let e=A.value,t=[];e.forEach(v=>{t.push(v._id)});try{const v=await We({name:q.value,tpdocument:w.value,numdocument:h.value,role:E.value,farms:t,email:U.value,password:I.value},B.value);g.value=!1;let _=(z=(c=(k=v==null?void 0:v.response)==null?void 0:k.data)==null?void 0:c.errors[0])==null?void 0:z.msg;_==R.USEREXIST?u("negative","El usuario ya existe"):_==R.LENGTHPASSWORD?u("negative","La contraseña debe tener de 6 a 20 carácteres"):_==R.RULESPASSWORD?u("negative","La contraseña debe tener una letra mayúscula, una letra minúscula y un número"):_==R.EMAILEXIST?u("negative","El email ya esta registrado"):(l.toggleModal(),x.value=[],u("positive","Usuario registrado correctamente"),P())}catch{g.value=!1,u("negative","Ocurrió un error")}}async function Ue(e){f.value=!0;try{await Xe(e,B.value),f.value=!1,u("positive","Usuario activado correctamente"),x.value=[],F.value=[],P()}catch{f.value=!1,u("negative","Ocurrió un error al activar el usuario")}}async function Ve(e){f.value=!0;try{await Ge(e,B.value),u("positive","Usuario desactivado correctamente"),f.value=!1,x.value=[],F.value=[],P()}catch{f.value=!1,u("negative","Ocurrió un error al desactivar el usuario")}}const B=ue(()=>me.idSelected);return de(B,()=>{P()}),Te(()=>{P()}),(e,t)=>{const k=y("q-separator"),c=y("q-tab"),z=y("q-tabs"),v=y("q-icon"),_=y("q-input"),J=y("q-btn"),oe=y("q-btn-group"),se=y("q-table"),ne=y("q-tab-panel"),ke=y("q-tab-panels"),xe=y("q-card"),Ae=y("q-spinner-ios");return S(),Y(Ne,null,[i("div",Je,[Ke,n(k,{class:"separator"}),i("div",Ye,[n(Me,{onOnClick:Se,label:"Crear nuevo usuario"}),i("div",Ze,[n(xe,null,{default:p(()=>[n(z,{modelValue:s(O),"onUpdate:modelValue":t[0]||(t[0]=a=>b(O)?O.value=a:O=a),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:p(()=>[n(c,{name:"active",label:"Activos"}),n(c,{name:"inactive",label:"Inactivos"})]),_:1},8,["modelValue"]),n(k),n(ke,{modelValue:s(O),"onUpdate:modelValue":t[3]||(t[3]=a=>b(O)?O.value=a:O=a),animated:""},{default:p(()=>[n(ne,{name:"active"},{default:p(()=>[n(se,{flat:"",bordered:"",title:"Usuarios","row-key":"name",rows:x.value,columns:le.value,filter:s(V),loading:f.value,"rows-per-page-options":[5,10,20]},{"top-right":p(()=>[n(_,{borderless:"",dense:"",debounce:"300",modelValue:s(V),"onUpdate:modelValue":t[1]||(t[1]=a=>b(V)?V.value=a:V=a),placeholder:"Buscar"},{append:p(()=>[n(v,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-Acciones":p(a=>[i("td",ea,[n(oe,{class:"full-width full-height",outline:"",square:""},{default:p(()=>[n(J,{icon:"edit_note","text-color":"blue-10",class:"col text-bold q-pa-none icon-table",onClick:re=>we(a.row)},null,8,["onClick"]),a.row.role=="ADMIN"?(S(),D(J,{key:0,icon:"highlight_off","text-color":"blue-10",class:"col text-bold q-pa-none icon-table",onClick:re=>Ve(a.row._id)},null,8,["onClick"])):N("",!0)]),_:2},1024)])]),_:1},8,["rows","columns","filter","loading"])]),_:1}),n(ne,{name:"inactive"},{default:p(()=>[n(se,{flat:"",bordered:"",title:"Usuarios","row-key":"name",rows:F.value,columns:le.value,filter:s(V),loading:f.value,"rows-per-page-options":[5,10,20]},{"top-right":p(()=>[n(_,{borderless:"",dense:"",debounce:"300",modelValue:s(V),"onUpdate:modelValue":t[2]||(t[2]=a=>b(V)?V.value=a:V=a),placeholder:"Buscar"},{append:p(()=>[n(v,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-Acciones":p(a=>[i("td",aa,[n(oe,{class:"full-width full-height",outline:"",square:""},{default:p(()=>[n(J,{"text-color":"blue-10",class:"col q-pa-none",onClick:re=>Ue(a.row._id)},{default:p(()=>[ta]),_:2},1032,["onClick"])]),_:2},1024)])]),_:1},8,["rows","columns","filter","loading"])]),_:1})]),_:1},8,["modelValue"])]),_:1})])])]),s(l).modalIsOpen?(S(),D(ze,{key:0,class:"modal"},{default:p(()=>[i("div",la,[i("h6",oa,ee(L.value),1),i("div",sa,[i("div",na,[n(ie,{label:"Nombre",type:"text",required:!0,ruless:T,value:s(G),modelValue:s(q),"onUpdate:modelValue":t[4]||(t[4]=a=>b(q)?q.value=a:q=a),onOnWrite:ve},null,8,["value","modelValue"]),i("div",ra,[n(K,{class:"q-pb-xs q-mb-md",type:"documents",label:"Tipo de documento",required:!0,ruless:T,value:s(X),modelValue:s(w),"onUpdate:modelValue":t[5]||(t[5]=a=>b(w)?w.value=a:w=a),onOnSelect:pe},null,8,["value","modelValue"]),n(ie,{label:"Número documento",type:"number",required:!0,ruless:T,value:s($),modelValue:s(h),"onUpdate:modelValue":t[6]||(t[6]=a=>b(h)?h.value=a:h=a),onOnWrite:fe},null,8,["value","modelValue"])]),s(C)!="SUPER"?(S(),D(K,{key:0,class:"col-4 q-pb-xs q-mb-md",type:"roles",label:"Rol",required:!0,ruless:T,value:s(C),modelValue:s(E),"onUpdate:modelValue":t[7]||(t[7]=a=>b(E)?E.value=a:E=a),onOnSelect:_e},null,8,["value","modelValue"])):N("",!0),s(C)!="SUPER"?(S(),D(K,{key:1,class:"q-pb-xs q-mb-md",label:"Acceso",type:"multiFarms",required:!0,ruless:T,value:s(H),modelValue:s(A),"onUpdate:modelValue":t[8]||(t[8]=a=>b(A)?A.value=a:A=a),onOnSelect:ye},null,8,["value","modelValue"])):N("",!0),s(C)!="SUPER"?(S(),D(Qe,{key:2,label:"Email",required:!0,ruless:T,value:s(Q),modelValue:s(U),"onUpdate:modelValue":t[9]||(t[9]=a=>b(U)?U.value=a:U=a),onOnEmail:ge},null,8,["value","modelValue"])):N("",!0),s(C)!="SUPER"?(S(),D(Pe,{key:3,label:"Contraseña",required:!0,ruless:T,modelValue:s(I),"onUpdate:modelValue":t[10]||(t[10]=a=>b(I)?I.value=a:I=a),onOnPassword:be},null,8,["modelValue"])):N("",!0),ua,i("div",ia,[M.value?(S(),D(ce,{key:0,disable:s(te),onOnClick:Ee},null,8,["disable"])):(S(),D(ce,{key:1,disable:s(te),onOnClick:he},null,8,["disable"]))]),g.value?(S(),Y("div",ca,[n(Ae,{color:"primary",size:"2.5em"})])):N("",!0)])])])]),_:1})):N("",!0)],64)}}},pa=Oe(da,[["__scopeId","data-v-d5e9ede2"]]);export{pa as default};
