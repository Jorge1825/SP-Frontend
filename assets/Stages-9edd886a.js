import{l as I,s as z,_ as _e,m as ge,q as be,g as s,v as he,f as K,x as ye,y as qe,r as v,o as C,c as X,a as i,d as t,w as r,h as c,i as L,M as we,j as Y,F as Se,D as U,z as E,t as ke,A as Z,E as xe,B as ee,p as Ee,e as Ve,C as ae}from"./index-6c614867.js";import{B as Ae}from"./ButtonAdd-91711192.js";const Ce=async n=>{try{const d=I(),{data:o}=await z.get("/maintenance/stage",{headers:{token:d,farm:n}});return o}catch(d){return d}},Ie=async(n,d)=>{try{const o=I(),{data:p}=await z.post("/maintenance/stage/register",{name:n.name,lot:n.lot,description:n.description},{headers:{token:o,farm:d}});return p}catch(o){return o}},ze=async(n,d)=>{try{const o=I(),{data:p}=await z.put(`/maintenance/stage/update/${n.id}`,{name:n.name,lot:n.lot,description:n.description},{headers:{token:o,farm:d}});return p}catch(o){return o}},Oe=async(n,d)=>{try{const o=I(),{data:p}=await z.put(`/maintenance/stage/inactive/${n}`,{},{headers:{token:o,farm:d}});return p}catch(o){return o}},Me=async(n,d)=>{try{const o=I(),{data:p}=await z.put(`/maintenance/stage/active/${n}`,{},{headers:{token:o,farm:d}});return p}catch(o){return o}};const F=n=>(Ee("data-v-adcb0715"),n=n(),Ve(),n),De={class:"q-py-md table-container"},Ne={class:"row"},Be=F(()=>i("h6",{class:"title q-my-lg"},"ETAPAS",-1)),Te={class:"container-content"},Re={class:"container-table q-mt-md q-pa-md",rounded:""},Le={class:"accions-td"},Ue={class:"accions-td"},Fe=F(()=>i("i",{class:"icon icon-check"},null,-1)),$e={class:"q-my-md text-center"},je={class:"row q-px-xl"},Pe={class:"col-12"},We=F(()=>i("span",{class:"text-required q-pb-sm"},[ae("Todos los campos con "),i("span",{class:"text-red"},"*"),ae(" son obligatorios")],-1)),Ge={class:"row justify-center"},Qe={key:0,class:"spinner"},He={__name:"Stages",setup(n){const d=ge(),o=be(),p=s(""),f=s(!1),D=s(!0),S=s([]),V=s([]),$=s(),te=he(),q=s(!1),j=K(()=>m.value==""?!0:q.value==!0),P=[e=>!!e||"Este campo es requerido"];let g=s(""),w=s("active"),m=s(""),_=s(""),b=s(""),N=s(""),B=s(""),T=s("");const W=s([{name:"id",label:"#",field:"id",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"name",label:"Nombre",field:"name",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"lot",label:"Lote",field:"lot",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"description",label:"Descripción",field:"description",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"Acciones",label:"Acciones",field:"acciones",align:"left",sortable:!0,headerStyle:"font-size: var(--font-medium); font-weight: bold;",style:"font-size: var(--font-medium);"}]),oe=e=>{m.value=e},le=e=>{_.value=e},ne=e=>{b.value=e},se=()=>{p.value="REGISTRAR ETAPA",re(),D.value=!0,o.toggleModal()},re=()=>{N.value="",B.value="",T.value="",m.value="",_.value="",b.value=""},ce=e=>{p.value="EDITAR ETAPA",D.value=!1,$.value=e._id,N.value=e.name,m.value=e.name,B.value=e.description,b.value=e.description,T.value=e.lot,_.value=e.lot,o.toggleModal()},h=(e,a)=>{d.notify({type:e,message:a,position:"top"})},k=async()=>{S.value=[],V.value=[],f.value=!0;try{const{stages:e}=await Ce(y.value),{lots:a}=await U(y.value);let O=1,M=1;e.forEach(u=>{u.status=u.status?"Inactivo":"Activo";let x=u.lot;a.forEach(A=>{A._id==x&&(x=A.name)}),u.lot=x,u.status=="Activo"?(u.id=O++,S.value.push(u)):(u.id=M++,V.value.push(u)),u.description=u.description.trim()==""?"No registra":u.description}),f.value=!1}catch{f.value=!1,h("negative","Ocurrió un error")}};async function ie(){q.value=!0;const{lots:e}=await U(y.value);e.forEach(a=>{a.name==_.value&&(_.value=a._id)});try{await Ie({name:m.value,lot:_.value,description:b.value},y.value),q.value=!1,h("positive","Etapa registrada correctamente"),o.toggleModal(),S.value=[],k()}catch{q.value=!1,h("negative","Ocurrió un error, por favor verifique los datos")}}async function ue(){q.value=!0;const{lots:e}=await U(y.value);e.forEach(a=>{a.name==_.value&&(_.value=a._id)});try{await ze({id:$.value,name:m.value,lot:_.value,description:b.value},y.value),q.value=!1,h("positive","Etapa actualizada correctamente"),o.toggleModal(),S.value=[],k()}catch{q.value=!1,h("negative","Ocurrió un error, por favor verifique los datos")}m.value="",_.value="",b.value=""}async function de(e){f.value=!0;try{const a=await Me(e,y.value);h("positive","Etapa activada correctamente"),f.value=!1,S.value=[],V.value=[],k()}catch{f.value=!1,h("negative","Ocurrió un error")}}async function ve(e){f.value=!1;try{const a=await Oe(e,y.value);f.value=!1,h("positive","Etapa desactivada correctamente"),S.value=[],V.value=[],k()}catch{f.value=!1,h("negative","Ocurrió un error")}}const y=K(()=>te.idSelected);return ye(y,()=>{k()}),qe(()=>{k()}),(e,a)=>{const O=v("q-separator"),M=v("q-tab"),u=v("q-tabs"),x=v("q-icon"),A=v("q-input"),R=v("q-btn"),G=v("q-btn-group"),Q=v("q-table"),H=v("q-tab-panel"),pe=v("q-tab-panels"),fe=v("q-card"),me=v("q-spinner-ios");return C(),X(Se,null,[i("div",De,[i("div",Ne,[i("i",{class:"icon icon-backRoute q-pt-lg",onClick:a[0]||(a[0]=l=>e.$router.back())}),Be]),t(O,{class:"separator"}),i("div",Te,[t(Ae,{onOnClick:se,label:"Crear nueva etapa"}),i("div",Re,[t(fe,null,{default:r(()=>[t(u,{modelValue:c(w),"onUpdate:modelValue":a[1]||(a[1]=l=>E(w)?w.value=l:w=l),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:r(()=>[t(M,{name:"active",label:"Activos"}),t(M,{name:"inactive",label:"Inactivos"})]),_:1},8,["modelValue"]),t(O),t(pe,{modelValue:c(w),"onUpdate:modelValue":a[4]||(a[4]=l=>E(w)?w.value=l:w=l),animated:""},{default:r(()=>[t(H,{name:"active"},{default:r(()=>[t(Q,{flat:"",bordered:"",title:"Etapas","row-key":"name",rows:S.value,columns:W.value,filter:c(g),loading:f.value,"rows-per-page-options":[5,10,20]},{"top-right":r(()=>[t(A,{borderless:"",dense:"",debounce:"300",modelValue:c(g),"onUpdate:modelValue":a[2]||(a[2]=l=>E(g)?g.value=l:g=l),placeholder:"Search"},{append:r(()=>[t(x,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-Acciones":r(l=>[i("td",Le,[t(G,{class:"full-width full-height",outline:"",square:""},{default:r(()=>[t(R,{icon:"edit_note","text-color":"blue-10",class:"col text-bold q-pa-none icon-table",onClick:J=>ce(l.row)},null,8,["onClick"]),t(R,{icon:"highlight_off","text-color":"blue-10",class:"col text-bold q-pa-none icon-table",onClick:J=>ve(l.row._id)},null,8,["onClick"])]),_:2},1024)])]),_:1},8,["rows","columns","filter","loading"])]),_:1}),t(H,{name:"inactive"},{default:r(()=>[t(Q,{flat:"",bordered:"",title:"Etapas","row-key":"name",rows:V.value,columns:W.value,filter:c(g),loading:f.value,"rows-per-page-options":[5,10,20]},{"top-right":r(()=>[t(A,{borderless:"",dense:"",debounce:"300",modelValue:c(g),"onUpdate:modelValue":a[3]||(a[3]=l=>E(g)?g.value=l:g=l),placeholder:"Search"},{append:r(()=>[t(x,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-Acciones":r(l=>[i("td",Ue,[t(G,{class:"full-width full-height",outline:"",square:""},{default:r(()=>[t(R,{"text-color":"blue-10",class:"col q-pa-none",onClick:J=>de(l.row._id)},{default:r(()=>[Fe]),_:2},1032,["onClick"])]),_:2},1024)])]),_:1},8,["rows","columns","filter","loading"])]),_:1})]),_:1},8,["modelValue"])]),_:1})])])]),c(o).modalIsOpen?(C(),L(we,{key:0},{default:r(()=>[i("h6",$e,ke(p.value),1),i("div",je,[i("div",Pe,[t(Z,{class:"q-pb-xs",label:"Nombre",required:!0,type:"text",ruless:P,value:c(N),modelValue:c(m),"onUpdate:modelValue":a[5]||(a[5]=l=>E(m)?m.value=l:m=l),onOnWrite:oe},null,8,["value","modelValue"]),t(xe,{class:"q-pb-lg",type:"lots",label:"Lote","v-model":c(_),required:!0,ruless:P,value:c(T),onOnSelect:le},null,8,["v-model","value"]),t(Z,{class:"q-pb-xs",label:"Descripción",type:"text",required:!1,value:c(B),modelValue:c(b),"onUpdate:modelValue":a[6]||(a[6]=l=>E(b)?b.value=l:b=l),onOnWrite:ne},null,8,["value","modelValue"]),We,i("div",Ge,[D.value?(C(),L(ee,{key:0,disable:c(j),onOnClick:ie},null,8,["disable"])):(C(),L(ee,{key:1,disable:c(j),onOnClick:ue},null,8,["disable"]))]),q.value?(C(),X("div",Qe,[t(me,{color:"primary",size:"2.5em"})])):Y("",!0)])])]),_:1})):Y("",!0)],64)}}},Xe=_e(He,[["__scopeId","data-v-adcb0715"]]);export{Xe as default};
