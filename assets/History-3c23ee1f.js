import{l as N,s as P,_ as Le,m as ze,q as Me,a0 as Be,g as i,v as Ne,f as le,x as Pe,y as Fe,r as f,a1 as He,o as L,c as se,a as e,d as o,w as c,h as d,i as W,M as J,j as G,F as We,z as w,t as A,E as K,a2 as $e,B as ne,A as je,C as q,p as Xe,e as Ge,a3 as Qe,R as I}from"./index-3a09a4c6.js";import{B as Je}from"./ButtonAdd-4b004f79.js";const Ke=async s=>{try{const m=N(),{data:r}=await P.get("/orders",{headers:{token:m,farm:s}});return r}catch(m){return m}},Ye=async(s,m)=>{try{const r=N(),{data:y}=await P.post("/orders/register",{name:s.name,tpdocument:s.tpdocument,numdocument:s.numdocument,role:s.role,farms:[s.farms],email:s.email,password:s.password},{headers:{token:r,farm:m}});return y}catch(r){return r}},Ze=async(s,m)=>{try{const r=N(),{data:y}=await P.put(`/orders/update/${s.id}`,{name:s.name,tpdocument:s.tpdocument,numdocument:s.numdocument,role:s.role,farms:[s.farms],email:s.email,password:s.password},{headers:{token:r,farm:m}});return y}catch(r){return r}},et=async(s,m)=>{try{const r=N(),{data:y}=await P.put(`/orders/inactive/${s}`,{},{headers:{token:r,farm:m}});return y}catch(r){return r}},tt=async(s,m)=>{try{const r=N(),{data:y}=await P.put(`/orders/active/${s}`,{},{headers:{token:r,farm:m}});return y}catch(r){return r}},at=async(s,m)=>{try{const r=N(),{data:y}=await P.put(`/orders/pay/${s}`,{},{headers:{token:r,farm:m}});return y}catch(r){return r}};const h=s=>(Xe("data-v-0ef58971"),s=s(),Ge(),s),ot={class:"q-py-md table-container"},lt={class:"row"},st=h(()=>e("h6",{class:"title q-my-lg"},"HISTORIAL DE PEDIDOS",-1)),nt={class:"container-content"},rt={class:"container-table q-mt-md q-pa-md",rounded:""},dt={class:"accions-td"},it={class:"accions-td"},ct=h(()=>e("i",{class:"icon icon-check"},null,-1)),ut={class:"modalSystem"},vt={class:"q-my-md text-center"},mt={class:"column q-px-xl"},pt={class:"col-12"},ft={class:"q-pt-md"},_t=h(()=>e("span",null,[q("Fecha de entrega"),e("span",{style:{color:"red"}},"*")],-1)),gt={class:"row items-center justify-end"},yt={class:"q-pb-sm column"},ht=h(()=>e("span",null,"Detalle del pedido:",-1)),bt={class:"column"},wt=h(()=>e("div",null,[e("span",null,"Total:"),e("span",{class:"total"},"500")],-1)),qt=h(()=>e("span",{class:"text-required q-py-sm"},[q("Todos los campos con "),e("span",{class:"text-red"},"*"),q(" son obligatorios")],-1)),St={class:"row justify-center q-mt-sm"},xt={key:0,class:"spinner"},kt={class:"modalSystem"},Et={class:"q-my-md text-center"},Ot={class:"row q-px-xl"},Vt={class:"col-12"},Ct={class:"row q-mt-xs buttons-modal"},Ut={class:"modalSystem"},At={class:"q-my-md text-center"},It={class:"row q-px-xl"},Rt={class:"column col-12",style:{"font-size":"16px"}},Dt={class:"q-pb-sm"},Tt=h(()=>e("span",{class:"text-bold"},"Cliente:",-1)),Lt={class:"q-pb-sm"},zt=h(()=>e("span",{class:"text-bold"},"Estado de la orden:",-1)),Mt={class:"q-pb-sm"},Bt=h(()=>e("span",{class:"text-bold"},"Estado del pago:",-1)),Nt={class:"q-pb-sm"},Pt=h(()=>e("span",{class:"text-bold"},"Fecha de entrega:",-1)),Ft={class:"q-pb-sm"},Ht=h(()=>e("span",{class:"text-bold"},"Valor total:",-1)),Wt={class:"q-pb-sm column"},$t=h(()=>e("span",{class:"text-bold"},"Detalle del pedido:",-1)),jt={class:"column"},Xt={__name:"History",setup(s){const m=ze(),r=Me(),y=Be(),re=i(),z=i(""),_=i(!1),x=i(!1),Y=i(!0),k=i([]),M=i([]),F=i([]),de=Ne(),$=i(!1);let ie=i(""),B=i(""),E=i(""),O=i(""),S=i(""),H=i(""),R=i(),ce=i(""),ue=i(""),ve=i(""),me=i(""),pe=i(""),b=i(""),V=i("active");const Z=le(()=>S.value?x.value==!0:!0),j=[l=>!!l||"Este campo es requerido"],ee=i([{name:"id",label:"Código",field:"id",align:"left",sortable:!0,headerStyle:"font-weight: bold;"},{name:"name",label:"Nombre",field:"name",align:"left",sortable:!0,headerStyle:"font-weight: bold;"},{name:"unitvalue",label:"Valor unitario",field:"unitvalue",align:"left",sortable:!0,headerStyle:"font-weight: bold;"},{name:"quantity",label:"Cantidad",field:"quantity",align:"left",sortable:!0,headerStyle:"font-weight: bold;"},{name:"cost",label:"Total",field:"cost",align:"left",sortable:!0,headerStyle:"font-weight: bold;"}]),te=i([{name:"id",label:"#",field:"id",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"client",label:"Cliente",field:"client",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"statusorder",label:"Estado de orden",field:"statusorder",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"dateorder",label:"Fecha entrega",field:"dateorder",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"Acciones",label:"Acciones",field:"acciones",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"}]),fe=l=>{S.value=l},_e=l=>{O.value=l},ge=l=>{H.value=l},ye=l=>{R.value=l},he=async()=>{const{models:l}=await Qe(C.value);$.value=!1;let t=1,p={};l.forEach(n=>{console.log(n.name),n.name==O.value&&(p={id:t++,name:O.value,unitvalue:n.unitvalue,quantity:R.value,cost:n.unitvalue*R.value},F.value.push(p))})},be=()=>{z.value="Registro de item",$.value=!0},we=()=>{z.value="REGISTRAR PEDIDO",Se(),Y.value=!0,r.toggleModal()},qe=()=>{$.value=!1,O.value=""},Se=()=>{ie.value="",S.value="",F.value=[]},xe=l=>{let t=1;z.value="DETALLE DE LA ORDEN",B.value=l,l.models.forEach(n=>{n.id=t++,F.value.push(n)}),y.toggleSHowDetailsModal()},u=(l,t)=>{m.notify({type:l,message:t,position:"top"})};async function D(){k.value=[],M.value=[],_.value=!0;try{const{orders:l}=await Ke(C.value);let t=1,p=1;l.forEach(n=>{n.status=n.status?"Inactivo":"Activo",n.status=="Activo"?(n.id=t++,k.value.push(n)):(n.id=p++,M.value.push(n)),n.client=n.client.name,n.dateorder=n.dateorder.slice(0,n.dateorder.indexOf("T"))}),_.value=!1}catch{u("negative","Ocurrió un error al obtener las ordenes")}}async function ke(){var p,n,T;x.value=!0;let l=farmsUserSystem.value,t=[];l.forEach(v=>{t.push(v._id)});try{const v=await Ze({id:re.value,name:S.value},C.value);x.value=!1;let g=(T=(n=(p=v==null?void 0:v.response)==null?void 0:p.data)==null?void 0:n.errors[0])==null?void 0:T.msg;g==I.USEREXIST?u("negative","El usuario ya existe"):g==I.LENGTHPASSWORD?u("negative","La contraseña debe tener de 6 a 20 carácteres"):g==I.RULESPASSWORD?u("negative","La contraseña debe tener una letra mayúscula, una letra minúscula y un número"):g==I.EMAILEXIST?u("negative","El email ya esta registrado"):(u("positive","Tipo de pago actualizado correctamente"),r.toggleModal(),k.value=[],D())}catch{x.value=!1,u("negative","Ocurrió un error")}}async function Ee(){var p,n,T;x.value=!0;let l=farmsUserSystem.value,t=[];l.forEach(v=>{t.push(v._id)});try{const v=await Ye({name:S.value},C.value);x.value=!1;let g=(T=(n=(p=v==null?void 0:v.response)==null?void 0:p.data)==null?void 0:n.errors[0])==null?void 0:T.msg;g==I.USEREXIST?u("negative","El usuario ya existe"):g==I.LENGTHPASSWORD?u("negative","La contraseña debe tener de 6 a 20 carácteres"):g==I.RULESPASSWORD?u("negative","La contraseña debe tener una letra mayúscula, una letra minúscula y un número"):g==I.EMAILEXIST?u("negative","El email ya esta registrado"):(r.toggleModal(),k.value=[],u("positive","Usuario registrado correctamente"),D())}catch{x.value=!1,u("negative","Ocurrió un error")}}async function Oe(l){_.value=!0;try{await tt(l,C.value),_.value=!1,u("positive","Usuario activado correctamente"),k.value=[],M.value=[],D()}catch{_.value=!1,u("negative","Ocurrió un error al activar el usuario")}}async function Ve(l){_.value=!0;try{await at(l,C.value),u("positive","Pedido pagado correctamente"),_.value=!1,k.value=[],M.value=[],D()}catch{_.value=!1,u("negative","Ocurrió un error al verificar el pago")}}async function Ce(l){_.value=!0;try{await et(l,C.value),u("positive","Usuario desactivado correctamente"),_.value=!1,k.value=[],M.value=[],D()}catch{_.value=!1,u("negative","Ocurrió un error al desactivar el usuario")}}const C=le(()=>de.idSelected);return Pe(C,()=>{D()}),Fe(()=>{D()}),(l,t)=>{const p=f("q-separator"),n=f("q-tab"),T=f("q-tabs"),v=f("q-icon"),g=f("q-input"),U=f("q-btn"),ae=f("q-btn-group"),X=f("q-table"),oe=f("q-tab-panel"),Ue=f("q-tab-panels"),Ae=f("q-card"),Ie=f("q-date"),Re=f("q-popup-proxy"),De=f("q-spinner-ios"),Te=He("close-popup");return L(),se(We,null,[e("div",ot,[e("div",lt,[e("i",{class:"icon icon-backRoute q-pt-lg",onClick:t[0]||(t[0]=a=>l.$router.back())}),st]),o(p,{class:"separator"}),e("div",nt,[o(Je,{onOnClick:we,label:"Crear nuevo pedido"}),e("div",rt,[o(Ae,null,{default:c(()=>[o(T,{modelValue:d(V),"onUpdate:modelValue":t[1]||(t[1]=a=>w(V)?V.value=a:V=a),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:c(()=>[o(n,{name:"active",label:"Activos"}),o(n,{name:"inactive",label:"Inactivos"})]),_:1},8,["modelValue"]),o(p),o(Ue,{modelValue:d(V),"onUpdate:modelValue":t[4]||(t[4]=a=>w(V)?V.value=a:V=a),animated:""},{default:c(()=>[o(oe,{name:"active"},{default:c(()=>[o(X,{flat:"",bordered:"",title:"Pedidos","row-key":"client",rows:k.value,columns:te.value,filter:d(b),loading:_.value,"rows-per-page-options":[5,10,20]},{"top-right":c(()=>[o(g,{borderless:"",dense:"",debounce:"300",modelValue:d(b),"onUpdate:modelValue":t[2]||(t[2]=a=>w(b)?b.value=a:b=a),placeholder:"Buscar"},{append:c(()=>[o(v,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-Acciones":c(a=>[e("td",dt,[o(ae,{class:"full-width full-height",outline:"",square:""},{default:c(()=>[o(U,{icon:"visibility","text-color":"blue-10",class:"col text-bold q-pa-none icon-table",onClick:Q=>xe(a.row)},null,8,["onClick"]),o(U,{icon:"payment","text-color":"blue-10",class:"col text-bold q-pa-none icon-table",onClick:Q=>Ve(a.row._id)},null,8,["onClick"]),o(U,{icon:"highlight_off","text-color":"blue-10",class:"col text-bold q-pa-none icon-table",onClick:Q=>Ce(a.row._id)},null,8,["onClick"])]),_:2},1024)])]),_:1},8,["rows","columns","filter","loading"])]),_:1}),o(oe,{name:"inactive"},{default:c(()=>[o(X,{flat:"",bordered:"",title:"Usuarios","row-key":"name",rows:M.value,columns:te.value,filter:d(b),loading:_.value,"rows-per-page-options":[5,10,20]},{"top-right":c(()=>[o(g,{borderless:"",dense:"",debounce:"300",modelValue:d(b),"onUpdate:modelValue":t[3]||(t[3]=a=>w(b)?b.value=a:b=a),placeholder:"Buscar"},{append:c(()=>[o(v,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-Acciones":c(a=>[e("td",it,[o(ae,{class:"full-width full-height",outline:"",square:""},{default:c(()=>[o(U,{"text-color":"blue-10",class:"col q-pa-none",onClick:Q=>Oe(a.row._id)},{default:c(()=>[ct]),_:2},1032,["onClick"])]),_:2},1024)])]),_:1},8,["rows","columns","filter","loading"])]),_:1})]),_:1},8,["modelValue"])]),_:1})])])]),d(r).modalIsOpen?(L(),W(J,{key:0,class:"modal"},{default:c(()=>[e("div",ut,[e("h6",vt,A(z.value),1),e("div",mt,[e("div",pt,[o(K,{label:"Cliente",type:"text",required:!0,ruless:j,value:d(pe),modelValue:d(S),"onUpdate:modelValue":t[5]||(t[5]=a=>w(S)?S.value=a:S=a),onOnWrite:fe},null,8,["value","modelValue"]),e("div",ft,[_t,o(g,{filled:"",dense:"",modelValue:d(E),"onUpdate:modelValue":t[7]||(t[7]=a=>w(E)?E.value=a:E=a),value:d(ce),mask:"date",rules:["date"]},{append:c(()=>[o(v,{name:"event",class:"cursor-pointer"},{default:c(()=>[o(Re,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:c(()=>[o(Ie,{modelValue:d(E),"onUpdate:modelValue":t[6]||(t[6]=a=>w(E)?E.value=a:E=a)},{default:c(()=>[e("div",gt,[$e(o(U,{label:"Close",color:"primary",flat:""},null,512),[[Te]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","value"])]),e("div",yt,[ht,e("div",bt,[o(X,{flat:"",bordered:"",style:{"max-width":"300px"},"row-key":"name",rows:F.value,columns:ee.value,"rows-per-page-options":[5,10,20],"hide-bottom":""},null,8,["rows","columns"])])]),o(U,{icon:"add",class:"button-add",label:"Agregar",onClick:t[8]||(t[8]=a=>be())}),wt,qt,e("div",St,[Y.value?(L(),W(ne,{key:0,disable:d(Z),onOnClick:Ee},null,8,["disable"])):(L(),W(ne,{key:1,disable:d(Z),onOnClick:ke},null,8,["disable"]))]),x.value?(L(),se("div",xt,[o(De,{color:"primary",size:"2.5em"})])):G("",!0)])])])]),_:1})):G("",!0),$.value?(L(),W(J,{key:1,class:"modal",show:"false"},{default:c(()=>[e("div",kt,[e("h6",Et,A(z.value),1),e("div",Ot,[e("div",Vt,[o(K,{type:"models",ruless:j,required:!0,label:"Producto",modelValue:d(O),"onUpdate:modelValue":t[9]||(t[9]=a=>w(O)?O.value=a:O=a),value:d(me),onOnSelect:_e},null,8,["modelValue","value"]),o(K,{class:"q-mt-lg",type:"state",ruless:j,required:!0,label:"Estado de orden",modelValue:d(H),"onUpdate:modelValue":t[10]||(t[10]=a=>w(H)?H.value=a:H=a),value:d(ve),onOnSelect:ge},null,8,["modelValue","value"]),o(je,{class:"q-mt-lg",label:"Cantidad",required:!0,type:"number",ruless:j,modelValue:d(R),"onUpdate:modelValue":t[11]||(t[11]=a=>w(R)?R.value=a:R=a),value:d(ue),onOnWrite:ye},null,8,["modelValue","value"]),e("div",Ct,[o(U,{class:"q-mx-sm",onClick:t[12]||(t[12]=a=>qe())},{default:c(()=>[q("Cancelar")]),_:1}),o(U,{class:"q-mx-sm",onClick:t[13]||(t[13]=a=>he())},{default:c(()=>[q("Agregar")]),_:1})])])])])]),_:1})):G("",!0),d(y).modalShowIsOpen?(L(),W(J,{key:2,class:"modal",showDetail:!0},{default:c(()=>[e("div",Ut,[e("h6",At,A(z.value),1),e("div",It,[e("div",Rt,[e("div",Dt,[Tt,q(" "+A(d(B).client),1)]),e("div",Lt,[zt,q(" "+A(d(B).statusorder),1)]),e("div",Mt,[Bt,q(" "+A(d(B).statuspay),1)]),e("div",Nt,[Pt,q(" "+A(d(B).dateorder),1)]),e("div",Ft,[Ht,q(" "+A(d(B).total),1)]),e("div",Wt,[$t,e("div",jt,[o(X,{flat:"",bordered:"",style:{"max-width":"300px"},"row-key":"name",rows:F.value,columns:ee.value,"rows-per-page-options":[5,10,20]},null,8,["rows","columns"])])])])])])]),_:1})):G("",!0)],64)}}},Jt=Le(Xt,[["__scopeId","data-v-0ef58971"]]);export{Jt as default};
