import{s as E,_ as me,l as ge,m as _e,g as s,q as be,f as J,v as ye,x as he,r as v,o as A,c as K,a as c,d as a,w as r,h as i,i as D,M as qe,j as X,F as we,y as S,t as Se,z as T,B as Y,p as ke,e as xe,A as Z}from"./index-a2b1bd69.js";import{g as I,B as Ve}from"./ButtonAdd-ed09f57b.js";const Ae=async n=>{try{const u=I(),{data:l}=await E.get("/maintenance/stage",{headers:{token:u,farm:n}});return l}catch(u){return u}},Ee=async(n,u)=>{try{const l=I(),{data:p}=await E.post("/maintenance/stage/register",{name:n.name,lot:n.lot,description:n.description},{headers:{token:l,farm:u}});return p}catch(l){return l}},Ie=async(n,u)=>{try{const l=I(),{data:p}=await E.put(`/maintenance/stage/update/${n.id}`,{name:n.name,lot:n.lot,description:n.description},{headers:{token:l,farm:u}});return p}catch(l){return l}},ze=async(n,u)=>{try{const l=I(),{data:p}=await E.put(`/maintenance/stage/inactive/${n}`,{},{headers:{token:l,farm:u}});return p}catch(l){return l}},Ce=async(n,u)=>{try{const l=I(),{data:p}=await E.put(`/maintenance/stage/active/${n}`,{},{headers:{token:l,farm:u}});return p}catch(l){return l}};const R=n=>(ke("data-v-7af1d8c6"),n=n(),xe(),n),Oe={class:"q-py-md table-container"},Me={class:"row"},Ne=R(()=>c("h6",{class:"title q-my-lg"},"ETAPAS",-1)),Be={class:"container-content"},De={class:"container-table q-mt-md q-pa-md",rounded:""},Te={class:"accions-td"},Re={class:"accions-td"},Ue=R(()=>c("i",{class:"icon icon-check"},null,-1)),Fe={class:"q-my-md text-center"},Le={class:"row q-px-xl"},je={class:"col-12"},Pe=R(()=>c("span",{class:"text-required q-pb-sm"},[Z("Todos los campos con "),c("span",{class:"text-red"},"*"),Z(" son obligatorios")],-1)),We={class:"row justify-center"},$e={key:0,class:"spinner"},Ge={__name:"Stages",setup(n){const u=ge(),l=_e(),p=s(""),f=s(!1),C=s(!0),w=s([]),V=s([]),U=s(),ee=be(),h=s(!1),F=J(()=>m.value==""?!0:h.value==!0),L=[e=>!!e||"Este campo es requerido"];let g=s(""),q=s("active"),m=s(""),_=s(""),b=s(""),O=s(""),M=s(""),N=s("");const j=s([{name:"id",label:"#",field:"id",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"name",label:"Nombre",field:"name",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"lot",label:"Lote",field:"lot",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"description",label:"Descripción",field:"description",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"status",label:"Estado",field:"status",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"Acciones",label:"Acciones",field:"acciones",align:"left",sortable:!0,headerStyle:"font-size: var(--font-medium); font-weight: bold;",style:"font-size: var(--font-medium);"}]),te=e=>{m.value=e},ae=e=>{_.value=e},oe=e=>{b.value=e},le=()=>{p.value="REGISTRAR ETAPA",ne(),C.value=!0,l.toggleModal()},ne=()=>{O.value="",M.value="",N.value="",m.value="",_.value="",b.value=""},se=e=>{p.value="EDITAR ETAPA",C.value=!1,U.value=e._id,O.value=e.name,N.value=e.lot,M.value=e.description,m.value=e.name,_.value=e.lot,b.value=e.description,l.toggleModal()},y=(e,o)=>{u.notify({type:e,message:o,position:"top"})},k=async()=>{w.value=[],V.value=[],f.value=!0;try{const{stages:e}=await Ae(x.value);let o=1,z=1;e.forEach(d=>{d.status=d.status?"Inactivo":"Activo",d.status=="Activo"?(d.id=o++,w.value.push(d)):(d.id=z++,V.value.push(d)),d.description=d.description.trim()==""?"No registra":d.description}),f.value=!1}catch{f.value=!1,y("negative","Ocurrió un error")}};async function re(){h.value=!0;try{const e=await Ee({name:m.value,lot:_.value,description:b.value},x.value);h.value=!1,y("positive","Etapa registrada correctamente"),l.toggleModal(),w.value=[],k()}catch{h.value=!1,y("negative","Ocurrió un error, por favor verifique los datos")}}async function ie(){h.value=!0;try{const e=await Ie({id:U.value,name:m.value,lot:_.value,description:b.value},x.value);h.value=!1,y("positive","Etapa actualizada correctamente"),l.toggleModal(),w.value=[],k()}catch{h.value=!1,y("negative","Ocurrió un error, por favor verifique los datos")}m.value="",_.value="",b.value=""}async function ce(e){f.value=!0;try{const o=await Ce(e,x.value);y("positive","Etapa activada correctamente"),f.value=!1,w.value=[],V.value=[],k()}catch{f.value=!1,y("negative","Ocurrió un error")}}async function ue(e){f.value=!1;try{const o=await ze(e,x.value);f.value=!1,y("positive","Etapa desactivada correctamente"),w.value=[],V.value=[],k()}catch{f.value=!1,y("negative","Ocurrió un error")}}const x=J(()=>ee.idSelected);return ye(x,()=>{k()}),he(()=>{k()}),(e,o)=>{const z=v("q-separator"),d=v("q-tab"),de=v("q-tabs"),P=v("q-icon"),W=v("q-input"),B=v("q-btn"),$=v("q-btn-group"),G=v("q-table"),Q=v("q-tab-panel"),ve=v("q-tab-panels"),pe=v("q-card"),fe=v("q-spinner-ios");return A(),K(we,null,[c("div",Oe,[c("div",Me,[c("i",{class:"icon icon-backRoute q-pt-lg",onClick:o[0]||(o[0]=t=>e.$router.back())}),Ne]),a(z,{class:"separator"}),c("div",Be,[a(Ve,{onOnClick:le,label:"Crear nueva etapa"}),c("div",De,[a(pe,null,{default:r(()=>[a(de,{modelValue:i(q),"onUpdate:modelValue":o[1]||(o[1]=t=>S(q)?q.value=t:q=t),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:r(()=>[a(d,{name:"active",label:"Activos"}),a(d,{name:"inactive",label:"Inactivos"})]),_:1},8,["modelValue"]),a(z),a(ve,{modelValue:i(q),"onUpdate:modelValue":o[4]||(o[4]=t=>S(q)?q.value=t:q=t),animated:""},{default:r(()=>[a(Q,{name:"active"},{default:r(()=>[a(G,{flat:"",bordered:"",title:"Etapas","row-key":"name",rows:w.value,columns:j.value,filter:i(g),loading:f.value,"rows-per-page-options":[5,10,20]},{"top-right":r(()=>[a(W,{borderless:"",dense:"",debounce:"300",modelValue:i(g),"onUpdate:modelValue":o[2]||(o[2]=t=>S(g)?g.value=t:g=t),placeholder:"Search"},{append:r(()=>[a(P,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-Acciones":r(t=>[c("td",Te,[a($,{class:"full-width full-height",outline:"",square:""},{default:r(()=>[a(B,{icon:"edit_note","text-color":"blue-10",class:"col text-bold q-pa-none",onClick:H=>se(t.row)},null,8,["onClick"]),a(B,{icon:"highlight_off","text-color":"blue-10",class:"col text-bold q-pa-none",onClick:H=>ue(t.row._id)},null,8,["onClick"])]),_:2},1024)])]),_:1},8,["rows","columns","filter","loading"])]),_:1}),a(Q,{name:"inactive"},{default:r(()=>[a(G,{flat:"",bordered:"",title:"Etapas","row-key":"name",rows:V.value,columns:j.value,filter:i(g),loading:f.value,"rows-per-page-options":[5,10,20]},{"top-right":r(()=>[a(W,{borderless:"",dense:"",debounce:"300",modelValue:i(g),"onUpdate:modelValue":o[3]||(o[3]=t=>S(g)?g.value=t:g=t),placeholder:"Search"},{append:r(()=>[a(P,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-Acciones":r(t=>[c("td",Re,[a($,{class:"full-width full-height",outline:"",square:""},{default:r(()=>[a(B,{"text-color":"blue-10",class:"col q-pa-none",onClick:H=>ce(t.row._id)},{default:r(()=>[Ue]),_:2},1032,["onClick"])]),_:2},1024)])]),_:1},8,["rows","columns","filter","loading"])]),_:1})]),_:1},8,["modelValue"])]),_:1})])])]),i(l).modalIsOpen?(A(),D(qe,{key:0},{default:r(()=>[c("h6",Fe,Se(p.value),1),c("div",Le,[c("div",je,[a(T,{class:"q-pb-xs",label:"Nombre",required:!0,type:"text",ruless:L,value:i(O),modelValue:i(m),"onUpdate:modelValue":o[5]||(o[5]=t=>S(m)?m.value=t:m=t),onOnWrite:te},null,8,["value","modelValue"]),a(T,{class:"q-pb-xs",label:"Lote",type:"text",required:!0,ruless:L,value:i(N),modelValue:i(_),"onUpdate:modelValue":o[6]||(o[6]=t=>S(_)?_.value=t:_=t),onOnWrite:ae},null,8,["value","modelValue"]),a(T,{class:"q-pb-xs",label:"Descripción",type:"text",required:!1,value:i(M),modelValue:i(b),"onUpdate:modelValue":o[7]||(o[7]=t=>S(b)?b.value=t:b=t),onOnWrite:oe},null,8,["value","modelValue"]),Pe,c("div",We,[C.value?(A(),D(Y,{key:0,disable:i(F),onOnClick:re},null,8,["disable"])):(A(),D(Y,{key:1,disable:i(F),onOnClick:ie},null,8,["disable"]))]),h.value?(A(),K("div",$e,[a(fe,{color:"primary",size:"2.5em"})])):X("",!0)])])]),_:1})):X("",!0)],64)}}},Je=me(Ge,[["__scopeId","data-v-7af1d8c6"]]);export{Je as default};
