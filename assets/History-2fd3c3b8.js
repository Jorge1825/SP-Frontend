import{l as F,s as P,_ as Ie,m as Ae,q as De,a5 as Ue,g as i,v as ze,f as Q,x as Re,y as Me,r as v,a6 as Te,o as z,c as Y,a as e,d as a,w as s,h as n,i as G,M as Z,j as B,F as Be,z as w,C as _,t as V,E as ee,a7 as Ne,B as Fe,A as Pe,p as $e,e as He,a8 as Le,a0 as je}from"./index-38b4e5a2.js";import{B as Qe}from"./ButtonAdd-30112040.js";const Ge=async c=>{try{const m=F(),{data:r}=await P.get("/orders",{headers:{token:m,farm:c}});return r}catch(m){return m}},We=async(c,m)=>{try{const r=F(),{data:h}=await P.post("/orders/register",{models:c.models,client:c.client,dateorder:c.dateorder,statusorder:c.statusorder},{headers:{token:r,farm:m}});return h}catch(r){return r}},Je=async(c,m)=>{try{const r=F(),{data:h}=await P.put(`/orders/inactive/${c}`,{},{headers:{token:r,farm:m}});return h}catch(r){return r}},Ke=async(c,m)=>{try{const r=F(),{data:h}=await P.put(`/orders/active/${c}`,{},{headers:{token:r,farm:m}});return h}catch(r){return r}},Xe=async(c,m)=>{try{const r=F(),{data:h}=await P.put(`/orders/pay/${c}`,{},{headers:{token:r,farm:m}});return h}catch(r){return r}};const f=c=>($e("data-v-91a197c6"),c=c(),He(),c),Ye={class:"q-py-md table-container"},Ze={class:"row"},et=f(()=>e("h6",{class:"title q-my-lg"},"HISTORIAL DE PEDIDOS",-1)),tt={class:"container-content"},at={class:"container-table q-mt-md q-pa-md",rounded:""},ot={class:"accions-td"},lt={class:"accions-td"},st=f(()=>e("i",{class:"icon icon-check"},null,-1)),nt={class:"modalSystem"},rt={class:"q-my-md text-center"},dt={class:"column q-px-xl"},it={class:"col-12"},ct={class:"q-pt-md"},ut=f(()=>e("span",null,[_("Fecha de entrega"),e("span",{style:{color:"red"}},"*")],-1)),vt={class:"row items-center justify-end"},_t={class:"q-pt-lg q-pb-sm column"},pt=f(()=>e("span",null,"Detalle del pedido:",-1)),mt={class:"column"},ft={class:"accions-td"},gt=f(()=>e("span",null,"Total:",-1)),ht={class:"total"},bt=f(()=>e("span",{class:"text-required q-py-sm"},[_("Todos los campos con "),e("span",{class:"text-red"},"*"),_(" son obligatorios")],-1)),yt={class:"row justify-center q-mt-sm"},wt={key:0,class:"spinner"},qt={class:"modalSystem"},xt={class:"q-my-md q-pt-lg text-center"},kt={class:"row q-px-xl"},St={class:"col-12"},Vt={class:"row q-mt-xs buttons-modal"},Ot={key:0,class:"spinner"},Ct={class:"modalSystem"},Et={class:"q-my-md text-center"},It={class:"row q-px-xl"},At={class:"column col-12",style:{"font-size":"16px"}},Dt={class:"q-pb-sm"},Ut=f(()=>e("span",{class:"text-bold"},"Cliente:",-1)),zt={class:"q-pb-sm"},Rt=f(()=>e("span",{class:"text-bold"},"Estado de la orden:",-1)),Mt={class:"q-pb-sm"},Tt=f(()=>e("span",{class:"text-bold"},"Estado del pago:",-1)),Bt={class:"q-pb-sm"},Nt=f(()=>e("span",{class:"text-bold"},"Fecha de entrega:",-1)),Ft={class:"q-pb-sm"},Pt=f(()=>e("span",{class:"text-bold"},"Valor total:",-1)),$t={class:"q-pb-sm column"},Ht=f(()=>e("span",{class:"text-bold"},"Detalle del pedido:",-1)),Lt={class:"column"},jt={__name:"History",setup(c){const m=Ae(),r=De(),h=Ue(),R=i(""),p=i(!1),q=i(!1),D=i([]),M=i([]),O=i([]),se=ze(),$=i(!1);let U=i(""),W=i([]),g=i(""),x=i(""),b=i(""),C=i(""),E=i(0),y=i(""),I=i("active");const ne=Q(()=>{let l=0;return O.value.forEach(t=>{l+=t.cost}),l}),re=Q(()=>!x.value||!E.value?!0:q.value==!0),de=Q(()=>!b.value||O.value.length==0||!g.value||!C.value?!0:q.value==!0),H=[l=>!!l||"Este campo es requerido"],te=i([{name:"Acciones",field:"acciones",align:"left",sortable:!0,headerStyle:"font-weight: bold;",style:"width: 10px"},{name:"name",label:"Nombre",field:"name",align:"left",sortable:!0,headerStyle:"font-weight: bold;"},{name:"unitvalue",label:"Valor unitario",field:"unitvalue",align:"left",sortable:!0,headerStyle:"font-weight: bold;"},{name:"quantity",label:"Cantidad",field:"quantity",align:"left",sortable:!0,headerStyle:"font-weight: bold;"},{name:"cost",label:"Total",field:"cost",align:"left",sortable:!0,headerStyle:"font-weight: bold;"}]),ae=i([{name:"id",label:"#",field:"id",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"client",label:"Cliente",field:"client",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"statusorder",label:"Estado de orden",field:"statusorder",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"dateorder",label:"Fecha entrega",field:"dateorder",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"Acciones",label:"Acciones",field:"acciones",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"}]),ie=l=>{console.log(l)},ce=l=>{b.value=l},ue=l=>{x.value=l},ve=l=>{C.value=l},_e=l=>{E.value=l},pe=async()=>{q.value=!0;const{models:l}=await Le(A.value);q.value=!1,$.value=!1;let t={};l.forEach((u,d)=>{u.name==x.value&&(t={codigo:d,id:u._id,name:x.value,unitvalue:u.unitvalue,quantity:parseInt(E.value),cost:u.unitvalue*E.value},console.log(t),O.value.push(t))})},me=()=>{R.value="Registro de item",$.value=!0},fe=()=>{R.value="REGISTRAR PEDIDO",he(),r.toggleModal()},ge=()=>{$.value=!1,x.value=""},he=()=>{b.value="",g.value="",C.value="",O.value=[],W.value=[]},be=l=>{let t=1;R.value="DETALLE DE LA ORDEN",U.value=l,console.log(U.value),l.models.forEach(d=>{d.id=t++,O.value.push(d)}),h.toggleSHowDetailsModal()},k=(l,t)=>{m.notify({type:l,message:t,position:"top"})};async function T(){D.value=[],M.value=[],p.value=!0;try{const{orders:l}=await Ge(A.value);p.value=!1;let t=1,u=1;l&&l.forEach(d=>{d.status=d.status?"Inactivo":"Activo",d.status=="Activo"?(d.id=t++,D.value.push(d)):(d.id=u++,M.value.push(d)),d.client=d.client.name,d.dateorder=d.dateorder.slice(0,d.dateorder.indexOf("T"))})}catch{p.value=!1,k("negative","Ocurrió un error al obtener las ordenes")}}async function ye(){let l={};O.value.forEach(u=>{l={id:u.id,quantity:u.quantity},W.value.push(l)}),q.value=!0;const{client:t}=await je(A.value);t.forEach(u=>{u.name==b.value&&(b.value=u._id)});try{await We({models:W.value,client:b.value,dateorder:g.value,statusorder:C.value},A.value),q.value=!1,r.toggleModal(),D.value=[],k("positive","Usuario registrado correctamente"),T()}catch{q.value=!1,k("negative","Ocurrió un error")}}async function we(l){p.value=!0;try{await Ke(l,A.value),p.value=!1,k("positive","Usuario activado correctamente"),D.value=[],M.value=[],T()}catch{p.value=!1,k("negative","Ocurrió un error al activar el usuario")}}async function qe(l){p.value=!0;try{await Xe(l,A.value),k("positive","Pedido pagado correctamente"),p.value=!1,D.value=[],M.value=[],T()}catch{p.value=!1,k("negative","Ocurrió un error al verificar el pago")}}async function xe(l){p.value=!0;try{await Je(l,A.value),k("positive","Usuario desactivado correctamente"),p.value=!1,D.value=[],M.value=[],T()}catch{p.value=!1,k("negative","Ocurrió un error al desactivar el usuario")}}const A=Q(()=>se.idSelected);return Re(A,()=>{T()}),Me(()=>{T()}),(l,t)=>{const u=v("q-separator"),d=v("q-tab"),ke=v("q-tabs"),J=v("q-icon"),K=v("q-input"),N=v("q-tooltip"),S=v("q-btn"),X=v("q-btn-group"),L=v("q-table"),oe=v("q-tab-panel"),Se=v("q-tab-panels"),Ve=v("q-card"),Oe=v("q-date"),Ce=v("q-popup-proxy"),le=v("q-spinner-ios"),Ee=Te("close-popup");return z(),Y(Be,null,[e("div",Ye,[e("div",Ze,[e("i",{class:"icon icon-backRoute q-pt-lg",onClick:t[0]||(t[0]=o=>l.$router.back())}),et]),a(u,{class:"separator"}),e("div",tt,[a(Qe,{onOnClick:fe,label:"Crear nuevo pedido"}),e("div",at,[a(Ve,null,{default:s(()=>[a(ke,{modelValue:n(I),"onUpdate:modelValue":t[1]||(t[1]=o=>w(I)?I.value=o:I=o),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:s(()=>[a(d,{name:"active",label:"Activos"}),a(d,{name:"inactive",label:"Inactivos"})]),_:1},8,["modelValue"]),a(u),a(Se,{modelValue:n(I),"onUpdate:modelValue":t[4]||(t[4]=o=>w(I)?I.value=o:I=o),animated:""},{default:s(()=>[a(oe,{name:"active"},{default:s(()=>[a(L,{flat:"",bordered:"",title:"Pedidos","row-key":"client",rows:D.value,columns:ae.value,filter:n(y),loading:p.value,"rows-per-page-options":[5,10,20]},{"top-right":s(()=>[a(K,{borderless:"",dense:"",debounce:"300",modelValue:n(y),"onUpdate:modelValue":t[2]||(t[2]=o=>w(y)?y.value=o:y=o),placeholder:"Buscar"},{append:s(()=>[a(J,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-Acciones":s(o=>[e("td",ot,[a(X,{class:"full-width full-height",outline:"",square:""},{default:s(()=>[a(S,{icon:"visibility","text-color":"blue-10",class:"col text-bold q-pa-none icon-table",onClick:j=>be(o.row)},{default:s(()=>[a(N,{class:"bg-indigo",offset:[10,10]},{default:s(()=>[_(" Ver detalles ")]),_:1})]),_:2},1032,["onClick"]),o.row.statuspay=="PENDIENTE"?(z(),G(S,{key:0,icon:"payment","text-color":"blue-10",class:"col text-bold q-pa-none icon-table",onClick:j=>qe(o.row._id)},{default:s(()=>[a(N,{class:"bg-indigo",offset:[10,10]},{default:s(()=>[_(" Marcar como pago ")]),_:1})]),_:2},1032,["onClick"])):B("",!0),a(S,{icon:"highlight_off","text-color":"blue-10",class:"col text-bold q-pa-none icon-table",onClick:j=>xe(o.row._id)},{default:s(()=>[a(N,{class:"bg-indigo",offset:[10,10]},{default:s(()=>[_(" Cancelar ")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)])]),_:1},8,["rows","columns","filter","loading"])]),_:1}),a(oe,{name:"inactive"},{default:s(()=>[a(L,{flat:"",bordered:"",title:"Usuarios","row-key":"name",rows:M.value,columns:ae.value,filter:n(y),loading:p.value,"rows-per-page-options":[5,10,20]},{"top-right":s(()=>[a(K,{borderless:"",dense:"",debounce:"300",modelValue:n(y),"onUpdate:modelValue":t[3]||(t[3]=o=>w(y)?y.value=o:y=o),placeholder:"Buscar"},{append:s(()=>[a(J,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-Acciones":s(o=>[e("td",lt,[a(X,{class:"full-width full-height",outline:"",square:""},{default:s(()=>[a(S,{"text-color":"blue-10",class:"col q-pa-none",onClick:j=>we(o.row._id)},{default:s(()=>[st,a(N,{class:"bg-indigo",offset:[10,10]},{default:s(()=>[_(" Activar ")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)])]),_:1},8,["rows","columns","filter","loading"])]),_:1})]),_:1},8,["modelValue"])]),_:1})])])]),n(r).modalIsOpen?(z(),G(Z,{key:0,class:"modal"},{default:s(()=>[e("div",nt,[e("h6",rt,V(R.value),1),e("div",dt,[e("div",it,[a(ee,{label:"Cliente",type:"client",required:!0,ruless:H,modelValue:n(b),"onUpdate:modelValue":t[5]||(t[5]=o=>w(b)?b.value=o:b=o),onOnSelect:ce},null,8,["modelValue"]),e("div",ct,[ut,a(K,{filled:"",dense:"",modelValue:n(g),"onUpdate:modelValue":t[7]||(t[7]=o=>w(g)?g.value=o:g=o),mask:"date",rules:["date"]},{append:s(()=>[a(J,{name:"event",class:"cursor-pointer"},{default:s(()=>[a(Ce,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:s(()=>[a(Oe,{modelValue:n(g),"onUpdate:modelValue":t[6]||(t[6]=o=>w(g)?g.value=o:g=o)},{default:s(()=>[e("div",vt,[Ne(a(S,{label:"Close",color:"primary",flat:""},null,512),[[Ee]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),a(ee,{type:"state",ruless:H,required:!0,label:"Estado de orden",modelValue:n(C),"onUpdate:modelValue":t[8]||(t[8]=o=>w(C)?C.value=o:C=o),onOnSelect:ve},null,8,["modelValue"]),e("div",_t,[pt,e("div",mt,[a(L,{flat:"",bordered:"",style:{"max-width":"300px"},"row-key":"name",rows:O.value,columns:te.value,"rows-per-page-options":[5,10,20],"hide-bottom":""},{"body-cell-Acciones":s(o=>[e("td",ft,[a(X,{class:"full-width full-height",outline:"",square:""},{default:s(()=>[a(S,{"text-color":"blue-10",class:"col q-pa-none",icon:"delete",onClick:j=>ie(o.row)},{default:s(()=>[a(N,{class:"bg-indigo",offset:[10,10]},{default:s(()=>[_(" Eliminar ")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)])]),_:1},8,["rows","columns"])])]),a(S,{icon:"add",class:"button-add",label:"Agregar",onClick:t[9]||(t[9]=o=>me())}),e("div",null,[gt,e("span",ht,V(n(ne)),1)]),bt,e("div",yt,[a(Fe,{disable:n(de),onOnClick:ye},null,8,["disable"])]),q.value?(z(),Y("div",wt,[a(le,{color:"primary",size:"2.5em"})])):B("",!0)])])])]),_:1})):B("",!0),$.value?(z(),G(Z,{key:1,class:"modal",show:"false"},{default:s(()=>[e("div",qt,[e("h6",xt,V(R.value),1),e("div",kt,[e("div",St,[a(ee,{type:"models",ruless:H,required:!0,label:"Producto",modelValue:n(x),"onUpdate:modelValue":t[10]||(t[10]=o=>w(x)?x.value=o:x=o),onOnSelect:ue},null,8,["modelValue"]),a(Pe,{class:"q-mt-lg",label:"Cantidad",required:!0,type:"number",ruless:H,modelValue:n(E),"onUpdate:modelValue":t[11]||(t[11]=o=>w(E)?E.value=o:E=o),onOnWrite:_e},null,8,["modelValue"]),e("div",Vt,[a(S,{class:"q-mx-sm button-one",onClick:t[12]||(t[12]=o=>ge())},{default:s(()=>[_("Cancelar")]),_:1}),a(S,{class:"q-mx-sm button-one",onClick:t[13]||(t[13]=o=>pe()),disable:n(re)},{default:s(()=>[_("Agregar")]),_:1},8,["disable"])]),q.value?(z(),Y("div",Ot,[a(le,{color:"primary",size:"2.5em"})])):B("",!0)])])])]),_:1})):B("",!0),n(h).modalShowIsOpen?(z(),G(Z,{key:2,class:"modal",showDetail:!0},{default:s(()=>[e("div",Ct,[e("h6",Et,V(R.value),1),e("div",It,[e("div",At,[e("div",Dt,[Ut,_(" "+V(n(U).client),1)]),e("div",zt,[Rt,_(" "+V(n(U).statusorder),1)]),e("div",Mt,[Tt,_(" "+V(n(U).statuspay),1)]),e("div",Bt,[Nt,_(" "+V(n(U).dateorder),1)]),e("div",Ft,[Pt,_(" "+V(n(U).total),1)]),e("div",$t,[Ht,e("div",Lt,[a(L,{flat:"",bordered:"",style:{"max-width":"300px"},"row-key":"name",rows:O.value,columns:te.value,"rows-per-page-options":[5,10,20]},null,8,["rows","columns"])])])])])])]),_:1})):B("",!0)],64)}}},Wt=Ie(jt,[["__scopeId","data-v-91a197c6"]]);export{Wt as default};
