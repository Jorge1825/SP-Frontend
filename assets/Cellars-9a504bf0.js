import{l as x,s as S,_ as ue,m as de,f as s,h as pe,q as ve,v as fe,r as f,o as B,c as me,a as d,d as a,w as c,i as r,g as M,M as ge,j as ye,F as _e,x as w,t as be,y as A,B as P,p as he,e as qe,z as X}from"./index-9b0f9ebe.js";import{g as I,B as we}from"./ButtonAdd-1e3a5e63.js";const Ce=async()=>{try{const o=I(),y=x().idSelected,{data:i}=await S.get("/inventory/cellar",{headers:{token:o,farm:y}});return i}catch(o){console.error(o)}},Ve=async o=>{try{const l=I(),i=x().idSelected,{data:p}=await S.post("/inventory/cellar/register",{name:o.name,typecontract:o.typecontract,description:o.description,value:o.value},{headers:{token:l,farm:i}});return p}catch(l){console.error(l)}},ke=async o=>{try{const l=I(),i=x().idSelected,{data:p}=await S.put(`/inventory/cellar/update/${o.id}`,{name:o.name,typecontract:o.typecontract,description:o.description,value:o.value},{headers:{token:l,farm:i}});return p}catch(l){console.error(l)}},xe=async o=>{try{const l=I(),i=x().idSelected,{data:p}=await S.put(`/inventory/cellar/inactive/${o}`,{},{headers:{token:l,farm:i}});return p}catch(l){console.error(l)}},Se=async o=>{try{const l=I(),i=x().idSelected,{data:p}=await S.put(`/inventory/cellar/active/${o}`,{},{headers:{token:l,farm:i}});return p}catch(l){console.error(l)}};const U=o=>(he("data-v-f6fda6e0"),o=o(),qe(),o),Ie={class:"q-py-sm table-container"},ze=U(()=>d("h6",{class:"title q-my-lg"},"Bodegas",-1)),Be={class:"container-content"},Ae={class:"container-table q-mt-md q-pa-md",rounded:""},Oe={class:"accions-td"},Ee={class:"accions-td"},De=U(()=>d("i",{class:"icon icon-check"},null,-1)),Fe={class:"q-my-md text-center"},Ne={class:"row q-px-xl"},Te={class:"col-12"},Me=U(()=>d("span",{class:"text-required q-pb-sm"},[X("Todos los campos con "),d("span",{class:"text-red"},"*"),X(" son obligatorios")],-1)),Ue={class:"row justify-center"},Re={__name:"Cellars",setup(o){const l=de(),y=s(""),i=s(!1),p=s(!0),C=s([]),V=s([]),R=s(),W=pe(()=>v.value==""),O=[e=>!!e||"Este campo es requerido"];let m=s(""),v=s(""),_=s(""),g=s(""),b=s(""),E=s(""),D=s(""),F=s(""),N=s(""),q=s("active");const h=ve(),j=s([{name:"id",label:"#",field:"id",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"name",label:"Nombre",field:"name",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"farm",label:"Finca",field:"farm",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"typecontract",label:"Tipo Contrato",field:"typecontract",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"description",label:"Descripción",field:"description",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"value",label:"Valor",field:"value",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"status",label:"Estado",field:"status",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"Acciones",label:"Acciones",field:"acciones",align:"left",sortable:!0,headerStyle:"font-size: var(--font-medium); font-weight: bold;",style:"font-size: var(--font-medium);"}]),Y=e=>{v.value=e},Z=e=>{_.value=e},$=e=>{g.value=e},ee=e=>{b.value=e},te=()=>{y.value="REGISTRAR BODEGAS",E.value="",D.value="",F.value="",N.value="",p.value=!0,l.toggleModal(),v.value="",_.value="",g.value="",b.value=""},ae=e=>{y.value="EDITAR BODEGAS",p.value=!1,R.value=e._id,E.value=e.name,D.value=e.typecontract,F.value=e.description,N.value=e.value,v.value=e.name,_.value=e.typecontract,g.value=e.description,b.value=e.value,l.toggleModal()};async function oe(e){try{const n=await xe(e);h.notify({type:"positive",message:"Bodega desactivada correctamente",position:"top"}),C.value=[],V.value=[],k()}catch{h.notify({type:"negative",message:"Ocurrió un error",position:"top"})}}async function le(){l.toggleModal();try{const e=await Ve({name:v.value,typecontract:_.value,description:g.value,value:b.value});h.notify({type:"positive",message:"Bodega registrada correctamente",position:"top"}),C.value=[],k()}catch{h.notify({type:"negative",message:"Ocurrió un error",position:"top"})}}const k=async()=>{C.value=[],V.value=[],i.value=!0;try{const{cellar:e}=await Ce();let n=1,z=1;e.forEach(u=>{u.status=u.status?"Inactivo":"Activo",u.status=="Activo"?(u.id=n++,C.value.push(u)):(u.id=z++,V.value.push(u)),u.description=u.description.trim()==""?"No registra":u.description}),i.value=!1}catch{h.notify({type:"negative",message:"Ocurrió un error",position:"top"})}};async function ne(){try{const e=await ke({id:R.value,name:v.value,typecontract:_.value,description:g.value,value:b.value});h.notify({type:"positive",position:"top",message:"Bodega actualizada correctamente"}),l.toggleModal(),C.value=[],k()}catch{h.notify({type:"negative",position:"top",message:"Ocurrió un error"})}v.value="",g.value=""}async function se(e){try{const n=await Se(e);h.notify({type:"positive",message:"Bodega activada correctamente",position:"top"}),C.value=[],V.value=[],k()}catch{h.notify({type:"negative",message:"Ocurrió un error",position:"top"})}}return fe(()=>{k()}),(e,n)=>{const z=f("q-separator"),u=f("q-tab"),re=f("q-tabs"),G=f("q-icon"),Q=f("q-input"),T=f("q-btn"),H=f("q-btn-group"),J=f("q-table"),K=f("q-tab-panel"),ce=f("q-tab-panels"),ie=f("q-card");return B(),me(_e,null,[d("div",Ie,[ze,a(z,{class:"separator"}),d("div",Be,[a(we,{onOnClick:te,label:"Crear nueva bodega"}),d("div",Ae,[a(ie,null,{default:c(()=>[a(re,{modelValue:r(q),"onUpdate:modelValue":n[0]||(n[0]=t=>w(q)?q.value=t:q=t),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:c(()=>[a(u,{name:"active",label:"Activos"}),a(u,{name:"inactive",label:"Inactivos"})]),_:1},8,["modelValue"]),a(z),a(ce,{modelValue:r(q),"onUpdate:modelValue":n[3]||(n[3]=t=>w(q)?q.value=t:q=t),animated:""},{default:c(()=>[a(K,{name:"active"},{default:c(()=>[a(J,{flat:"",bordered:"",title:"Bodegas","row-key":"name",rows:C.value,columns:j.value,filter:r(m),loading:i.value,"rows-per-page-options":[5,10,20]},{"top-right":c(()=>[a(Q,{borderless:"",dense:"",debounce:"300",modelValue:r(m),"onUpdate:modelValue":n[1]||(n[1]=t=>w(m)?m.value=t:m=t),placeholder:"Search"},{append:c(()=>[a(G,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-Acciones":c(t=>[d("td",Oe,[a(H,{class:"full-width full-height",outline:"",square:""},{default:c(()=>[a(T,{icon:"edit_note","text-color":"blue-10",class:"col text-bold q-pa-none",onClick:L=>ae(t.row)},null,8,["onClick"]),a(T,{icon:"highlight_off","text-color":"blue-10",class:"col text-bold q-pa-none",onClick:L=>oe(t.row._id)},null,8,["onClick"])]),_:2},1024)])]),_:1},8,["rows","columns","filter","loading"])]),_:1}),a(K,{name:"inactive"},{default:c(()=>[a(J,{flat:"",bordered:"",title:"Bodegas","row-key":"name",rows:V.value,columns:j.value,filter:r(m),loading:i.value,"rows-per-page-options":[5,10,20]},{"top-right":c(()=>[a(Q,{borderless:"",dense:"",debounce:"300",modelValue:r(m),"onUpdate:modelValue":n[2]||(n[2]=t=>w(m)?m.value=t:m=t),placeholder:"Search"},{append:c(()=>[a(G,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-Acciones":c(t=>[d("td",Ee,[a(H,{class:"full-width full-height",outline:"",square:""},{default:c(()=>[a(T,{"text-color":"blue-10",class:"col q-pa-none",onClick:L=>se(t.row._id)},{default:c(()=>[De]),_:2},1032,["onClick"])]),_:2},1024)])]),_:1},8,["rows","columns","filter","loading"])]),_:1})]),_:1},8,["modelValue"])]),_:1})])])]),r(l).modalIsOpen?(B(),M(ge,{key:0},{default:c(()=>[d("h6",Fe,be(y.value),1),d("div",Ne,[d("div",Te,[a(A,{label:"Nombre",required:!0,type:"text",ruless:O,value:r(E),modelValue:r(v),"onUpdate:modelValue":n[4]||(n[4]=t=>w(v)?v.value=t:v=t),onOnWrite:Y},null,8,["value","modelValue"]),a(A,{class:"q-pb-xs",label:"Tipo Contrato",required:!0,type:"text",ruless:O,value:r(D),modelValue:r(_),"onUpdate:modelValue":n[5]||(n[5]=t=>w(_)?_.value=t:_=t),onOnWrite:Z},null,8,["value","modelValue"]),a(A,{class:"q-mb-md",label:"Descripción",type:"text",required:!1,value:r(F),modelValue:r(g),"onUpdate:modelValue":n[6]||(n[6]=t=>w(g)?g.value=t:g=t),onOnWrite:$},null,8,["value","modelValue"]),a(A,{class:"q-pb-xs",label:"Valor",required:!0,type:"text",ruless:O,value:r(N),modelValue:r(b),"onUpdate:modelValue":n[7]||(n[7]=t=>w(b)?b.value=t:b=t),onOnWrite:ee},null,8,["value","modelValue"]),Me,d("div",Ue,[p.value?(B(),M(P,{key:0,disable:r(W),onOnClick:le},null,8,["disable"])):(B(),M(P,{key:1,disable:r(W),onOnClick:ne},null,8,["disable"]))])])])]),_:1})):ye("",!0)],64)}}},Ge=ue(Re,[["__scopeId","data-v-f6fda6e0"]]);export{Ge as default};
