import{l as M,s as F,g as r,x as de,r as f,o as b,c as J,a as c,C as K,t as Y,d as n,a0 as Ie,_ as Oe,m as De,q as Re,v as Ce,f as ue,y as Te,w as v,h as s,i as O,M as ze,j as T,F as Ne,z as g,A as ie,E as Q,a1 as Pe,B as ce,p as Be,e as Le,R as D}from"./index-8f765b36.js";import{B as Me}from"./ButtonAdd-2181087a.js";const Fe=async o=>{try{const d=M(),{data:l}=await F.get("/users",{headers:{token:d,farm:o}});return l}catch(d){return d}},We=async(o,d)=>{try{const l=M(),{data:m}=await F.post("/users/register",{name:o.name,tpdocument:o.tpdocument,numdocument:o.numdocument,role:o.role,farms:[o.farms],email:o.email,password:o.password},{headers:{token:l,farm:d}});return m}catch(l){return l}},je=async(o,d)=>{try{const l=M(),{data:m}=await F.put(`/users/update/${o.id}`,{name:o.name,tpdocument:o.tpdocument,numdocument:o.numdocument,role:o.role,farms:[o.farms],email:o.email,password:o.password},{headers:{token:l,farm:d}});return m}catch(l){return l}},Ge=async(o,d)=>{try{const l=M(),{data:m}=await F.put(`/users/inactive/${o}`,{},{headers:{token:l,farm:d}});return m}catch(l){return l}},Xe=async(o,d)=>{try{const l=M(),{data:m}=await F.put(`/users/active/${o}`,{},{headers:{token:l,farm:d}});return m}catch(l){return l}},$e=["for"],He={class:"text-red"},Qe={__name:"Email",props:{label:{type:String,required:!0},styles:{type:Object,required:!1},required:{type:Boolean,required:!1,default:!1},value:{required:!1,default:""}},emits:{onEmail:null},setup(o,{emit:d}){const l=o,m=r(l.value),P=[p=>p?p.match(/^\w+([.-_+]?\w+)*@\w+([.-]?\w+)*(\.\w{2,10})+$/)?!0:"El email no es valido":"Email requerido"];return de(m,()=>{d("onEmail",m.value)}),(p,y)=>{const B=f("q-input");return b(),J("div",{style:Ie(l.styles)},[c("span",{for:l.label},[K(Y(l.label),1),c("span",He,Y(l.required?"*":""),1)],8,$e),n(B,{modelValue:m.value,"onUpdate:modelValue":y[0]||(y[0]=x=>m.value=x),dense:"",filled:"",name:l.label,rules:P,type:l.type},null,8,["modelValue","name","type"])],4)}}};const Z=o=>(Be("data-v-e67829de"),o=o(),Le(),o),Je={class:"q-py-md table-container"},Ke=Z(()=>c("h6",{class:"title q-my-lg"},"ACCESO AL SISTEMA",-1)),Ye={class:"container-content"},Ze={class:"container-table q-mt-md q-pa-md",rounded:""},ea={class:"accions-td"},aa={class:"accions-td"},ta=Z(()=>c("i",{class:"icon icon-check"},null,-1)),la={class:"modalSystem"},oa={class:"q-my-md text-center"},sa={class:"row q-px-xl"},na={class:"col-12"},ra={class:"row justify-between"},ua=Z(()=>c("span",{class:"text-required q-py-sm"},[K("Todos los campos con "),c("span",{class:"text-red"},"*"),K(" son obligatorios")],-1)),ia={class:"row justify-center q-mt-sm"},ca={key:4,class:"spinner"},da={__name:"SystemView",setup(o){const d=De(),l=Re(),m=r(),P=r(""),p=r(!1),y=r(!1),B=r(!0),x=r([]),L=r([]),me=Ce();let W=r(""),j=r(""),G=r(""),R=r(""),X=r(""),$=r(""),S=r(""),q=r(""),w=r(""),h=r(""),E=r(""),U=r(""),A=r(""),V=r(""),I=r("active");const ee=ue(()=>!S.value||!q.value||!w.value||!E.value||!U.value||!A.value||!h.value?!0:y.value==!0),C=[e=>!!e||"Este campo es requerido"],ae=r([{name:"id",label:"#",field:"id",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"Nombre",label:"Nombre",field:"name",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"Tipo",label:"Tipo",field:"tpdocument",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"Documento",label:"Documento",field:"numdocument",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"email",label:"Correo Electronico",field:"email",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"role",label:"Rol",field:"role",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"Acciones",label:"Acciones",field:"acciones",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"}]),ve=e=>{S.value=e},pe=e=>{q.value=e},fe=e=>{w.value=e},ye=e=>{h.value=e},_e=e=>{E.value=e},ge=e=>{U.value=e},be=e=>{A.value=e},Se=()=>{P.value="REGISTRAR ACCESO",qe(),B.value=!0,l.toggleModal()},qe=()=>{W.value="",j.value="",G.value="",R.value="",X.value="",$.value="",S.value="",q.value="",w.value="",E.value="",U.value="",A.value="",h.value=""},we=e=>{P.value="EDITAR TIPO DE PAGO",B.value=!1,m.value=e._id,W.value=e.name,j.value=e.tpdocument,G.value=e.numdocument,R.value=e.role,X.value=e.farms,$.value=e.email,S.value=e.name,q.value=e.tpdocument,w.value=e.numdocument,E.value=e.role,U.value=e.email,l.toggleModal()},i=(e,t)=>{d.notify({type:e,message:t,position:"top"})};async function z(){x.value=[],L.value=[],p.value=!0;try{const e=await Fe(N.value);let t=1,k=1;e.forEach(u=>{u.status=u.status?"Inactivo":"Activo",u.status=="Activo"?(u.id=t++,x.value.push(u)):(u.id=k++,L.value.push(u))}),p.value=!1}catch{i("negative","Ocurrió un error al obtener los usuarios")}}async function he(){var e,t,k;y.value=!0,h.value.map(u=>u._id);try{const u=await je({id:m.value,name:S.value,tpdocument:q.value,numdocument:w.value,role:E.value,farms:h.value,email:U.value,password:A.value},N.value);y.value=!1;let _=(k=(t=(e=u==null?void 0:u.response)==null?void 0:e.data)==null?void 0:t.errors[0])==null?void 0:k.msg;_==D.USEREXIST?i("negative","El usuario ya existe"):_==D.LENGTHPASSWORD?i("negative","La contraseña debe tener de 6 a 20 carácteres"):_==D.RULESPASSWORD?i("negative","La contraseña debe tener una letra mayúscula, una letra minúscula y un número"):_==D.EMAILEXIST?i("negative","El email ya esta registrado"):(i("positive","Tipo de pago actualizado correctamente"),l.toggleModal(),x.value=[],z())}catch{y.value=!1,i("negative","Ocurrió un error")}}async function Ee(){var e,t,k;y.value=!0;try{const u=await We({name:S.value,tpdocument:q.value,numdocument:w.value,role:E.value,farms:h.value,email:U.value,password:A.value},N.value);y.value=!1;let _=(k=(t=(e=u==null?void 0:u.response)==null?void 0:e.data)==null?void 0:t.errors[0])==null?void 0:k.msg;_==D.USEREXIST?i("negative","El usuario ya existe"):_==D.LENGTHPASSWORD?i("negative","La contraseña debe tener de 6 a 20 carácteres"):_==D.RULESPASSWORD?i("negative","La contraseña debe tener una letra mayúscula, una letra minúscula y un número"):_==D.EMAILEXIST?i("negative","El email ya esta registrado"):(l.toggleModal(),x.value=[],i("positive","Usuario registrado correctamente"),z())}catch{y.value=!1,i("negative","Ocurrió un error")}}async function Ue(e){p.value=!0;try{await Xe(e,N.value),p.value=!1,i("positive","Usuario activado correctamente"),x.value=[],L.value=[],z()}catch{p.value=!1,i("negative","Ocurrió un error al activar el usuario")}}async function Ve(e){p.value=!0;try{await Ge(e,N.value),i("positive","Usuario desactivado correctamente"),p.value=!1,x.value=[],L.value=[],z()}catch{p.value=!1,i("negative","Ocurrió un error al desactivar el usuario")}}const N=ue(()=>me.idSelected);return de(N,()=>{z()}),Te(()=>{z()}),(e,t)=>{const k=f("q-separator"),u=f("q-tab"),_=f("q-tabs"),te=f("q-icon"),le=f("q-input"),H=f("q-btn"),oe=f("q-btn-group"),se=f("q-table"),ne=f("q-tab-panel"),ke=f("q-tab-panels"),xe=f("q-card"),Ae=f("q-spinner-ios");return b(),J(Ne,null,[c("div",Je,[Ke,n(k,{class:"separator"}),c("div",Ye,[n(Me,{onOnClick:Se,label:"Crear nuevo usuario"}),c("div",Ze,[n(xe,null,{default:v(()=>[n(_,{modelValue:s(I),"onUpdate:modelValue":t[0]||(t[0]=a=>g(I)?I.value=a:I=a),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:v(()=>[n(u,{name:"active",label:"Activos"}),n(u,{name:"inactive",label:"Inactivos"})]),_:1},8,["modelValue"]),n(k),n(ke,{modelValue:s(I),"onUpdate:modelValue":t[3]||(t[3]=a=>g(I)?I.value=a:I=a),animated:""},{default:v(()=>[n(ne,{name:"active"},{default:v(()=>[n(se,{flat:"",bordered:"",title:"Usuarios","row-key":"name",rows:x.value,columns:ae.value,filter:s(V),loading:p.value,"rows-per-page-options":[5,10,20]},{"top-right":v(()=>[n(le,{borderless:"",dense:"",debounce:"300",modelValue:s(V),"onUpdate:modelValue":t[1]||(t[1]=a=>g(V)?V.value=a:V=a),placeholder:"Buscar"},{append:v(()=>[n(te,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-Acciones":v(a=>[c("td",ea,[n(oe,{class:"full-width full-height",outline:"",square:""},{default:v(()=>[n(H,{icon:"edit_note","text-color":"blue-10",class:"col text-bold q-pa-none icon-table",onClick:re=>we(a.row)},null,8,["onClick"]),a.row.role=="ADMIN"?(b(),O(H,{key:0,icon:"highlight_off","text-color":"blue-10",class:"col text-bold q-pa-none icon-table",onClick:re=>Ve(a.row._id)},null,8,["onClick"])):T("",!0)]),_:2},1024)])]),_:1},8,["rows","columns","filter","loading"])]),_:1}),n(ne,{name:"inactive"},{default:v(()=>[n(se,{flat:"",bordered:"",title:"Usuarios","row-key":"name",rows:L.value,columns:ae.value,filter:s(V),loading:p.value,"rows-per-page-options":[5,10,20]},{"top-right":v(()=>[n(le,{borderless:"",dense:"",debounce:"300",modelValue:s(V),"onUpdate:modelValue":t[2]||(t[2]=a=>g(V)?V.value=a:V=a),placeholder:"Buscar"},{append:v(()=>[n(te,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-Acciones":v(a=>[c("td",aa,[n(oe,{class:"full-width full-height",outline:"",square:""},{default:v(()=>[n(H,{"text-color":"blue-10",class:"col q-pa-none",onClick:re=>Ue(a.row._id)},{default:v(()=>[ta]),_:2},1032,["onClick"])]),_:2},1024)])]),_:1},8,["rows","columns","filter","loading"])]),_:1})]),_:1},8,["modelValue"])]),_:1})])])]),s(l).modalIsOpen?(b(),O(ze,{key:0,class:"modal"},{default:v(()=>[c("div",la,[c("h6",oa,Y(P.value),1),c("div",sa,[c("div",na,[n(ie,{label:"Nombre",type:"text",required:!0,ruless:C,value:s(W),modelValue:s(S),"onUpdate:modelValue":t[4]||(t[4]=a=>g(S)?S.value=a:S=a),onOnWrite:ve},null,8,["value","modelValue"]),c("div",ra,[n(Q,{class:"q-pb-xs q-mb-md",type:"documents",label:"Tipo de documento",required:!0,ruless:C,value:s(j),modelValue:s(q),"onUpdate:modelValue":t[5]||(t[5]=a=>g(q)?q.value=a:q=a),onOnSelect:pe},null,8,["value","modelValue"]),n(ie,{label:"Número documento",type:"number",required:!0,ruless:C,value:s(G),modelValue:s(w),"onUpdate:modelValue":t[6]||(t[6]=a=>g(w)?w.value=a:w=a),onOnWrite:fe},null,8,["value","modelValue"])]),s(R)!="SUPER"?(b(),O(Q,{key:0,class:"col-4 q-pb-xs q-mb-md",type:"roles",label:"Rol",required:!0,ruless:C,value:s(R),modelValue:s(E),"onUpdate:modelValue":t[7]||(t[7]=a=>g(E)?E.value=a:E=a),onOnSelect:_e},null,8,["value","modelValue"])):T("",!0),s(R)!="SUPER"?(b(),O(Q,{key:1,class:"q-pb-xs q-mb-md",label:"Acceso",type:"multiFarms",required:!0,ruless:C,value:s(X),modelValue:s(h),"onUpdate:modelValue":t[8]||(t[8]=a=>g(h)?h.value=a:h=a),onOnSelect:ye},null,8,["value","modelValue"])):T("",!0),s(R)!="SUPER"?(b(),O(Qe,{key:2,label:"Email",required:!0,ruless:C,value:s($),modelValue:s(U),"onUpdate:modelValue":t[9]||(t[9]=a=>g(U)?U.value=a:U=a),onOnEmail:ge},null,8,["value","modelValue"])):T("",!0),s(R)!="SUPER"?(b(),O(Pe,{key:3,label:"Contraseña",required:!0,ruless:C,modelValue:s(A),"onUpdate:modelValue":t[10]||(t[10]=a=>g(A)?A.value=a:A=a),onOnPassword:be},null,8,["modelValue"])):T("",!0),ua,c("div",ia,[B.value?(b(),O(ce,{key:0,disable:s(ee),onOnClick:Ee},null,8,["disable"])):(b(),O(ce,{key:1,disable:s(ee),onOnClick:he},null,8,["disable"]))]),y.value?(b(),J("div",ca,[n(Ae,{color:"primary",size:"2.5em"})])):T("",!0)])])])]),_:1})):T("",!0)],64)}}},pa=Oe(da,[["__scopeId","data-v-e67829de"]]);export{pa as default};
