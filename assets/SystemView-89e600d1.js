import{g as z,B as Se}from"./ButtonAdd-1e3a5e63.js";import{s as N,_ as qe,q as xe,m as Ve,f as s,l as Ue,h as ee,A as ke,v as Ee,r as i,o as S,c as te,a as c,d as o,w as u,i as l,g as V,M as Ae,j as O,F as De,x as g,z as W,t as Ie,y as ae,E as oe,H as Oe,B as le,p as Ce,e as Re,R as j}from"./index-9b0f9ebe.js";const ze=async r=>{try{const d=z(),{data:n}=await N.get("/users",{headers:{token:d,farm:r}});return n}catch(d){return d}},Ne=async(r,d)=>{try{const n=z(),{data:q}=await N.post("/users/register",{name:r.name,tpdocument:r.tpdocument,numdocument:r.numdocument,role:r.role,password:r.password},{headers:{token:n,farm:d}});return q}catch(n){return n}},Te=async(r,d)=>{try{const n=z(),{data:q}=await N.put(`/users/inactive/${r}`,{},{headers:{token:n,farm:d}});return q}catch(n){return n}},Be=async(r,d)=>{try{const n=z(),{data:q}=await N.put(`/users/active/${r}`,{},{headers:{token:n,farm:d}});return q}catch(n){return n}};const G=r=>(Ce("data-v-cc86bb49"),r=r(),Re(),r),Me={class:"q-py-md table-container"},Pe=G(()=>c("h6",{class:"title q-my-lg"},"ACCESO AL SISTEMA",-1)),Le={class:"container-content"},Fe={class:"container-table q-mt-md q-pa-md",rounded:""},je={style:{padding:"0px",margin:"0px","min-width":"100px","max-width":"20px"}},We={style:{padding:"0px",margin:"0px","min-width":"100px","max-width":"100px"}},Ge=G(()=>c("i",{class:"icon icon-check"},null,-1)),He={class:"modalSystem"},Qe={class:"q-my-md text-center"},Xe={class:"row q-px-xl"},Je={class:"col-12"},Ke={class:"row justify-between"},Ye=G(()=>c("span",{class:"text-required q-py-sm"},[W("Todos los campos con "),c("span",{class:"text-red"},"*"),W(" son obligatorios")],-1)),Ze={class:"row justify-center q-mt-sm"},$e={key:2,class:"spinner"},et={__name:"SystemView",setup(r){const d=xe(),n=Ve(),q=s(),T=s(""),U=s(!1),k=s(!1),B=s(!0),x=s([]),E=s([]),se=Ue();let M=s(""),P=s(""),L=s(""),A=s(""),f=s(""),_=s(""),b=s(""),y=s(""),h=s(""),m=s(""),w=s("active");const H=ee(()=>!f.value||!_.value||!b.value||!y.value||!h.value?!0:k.value==!0),C=[e=>!!e||"Este campo es requerido"],Q=s([{name:"id",label:"#",field:"id",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"Nombre",label:"Nombre",field:"name",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"Tipo",label:"Tipo",field:"tpdocument",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"Documento",label:"Documento",field:"numdocument",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"role",label:"Rol",field:"role",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"status",label:"Estado",field:"status",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"Acciones",label:"Acciones",field:"acciones",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"}]),ne=e=>{f.value=e},re=e=>{_.value=e},ue=e=>{b.value=e},ce=e=>{y.value=e},ie=e=>{h.value=e},de=e=>{T.value="REGISTRAR ACCESO",me(),B.value=!0,n.toggleModal()},me=()=>{M.value="",P.value="",L.value="",A.value="",f.value="",_.value="",b.value="",y.value="",h.value=""},ve=e=>{T.value="EDITAR TIPO DE PAGO",B.value=!1,q.value=e._id,M.value=e.name,P.value=e.tpdocument,L.value=e.numdocument,A.value=e.role,f.value=e.name,_.value=e.tpdocument,b.value=e.numdocument,y.value=e.role,n.toggleModal()},v=(e,a)=>{d.notify({type:e,message:a,position:"top"})};async function pe(){U.value=!0,k.value=!0}async function D(){x.value=[],E.value=[],U.value=!0;try{const e=await ze(I.value);let a=1,R=1;e.forEach(p=>{p.status=p.status?"Inactivo":"Activo",p.status=="Activo"?(p.id=a++,x.value.push(p)):(p.id=R++,E.value.push(p))}),U.value=!1}catch{v("negative","Ocurrió un error al obtener los usuarios")}}async function fe(e){try{const a=await Te(e,I.value);v("positive","Usuario desactivado correctamente"),x.value=[],E.value=[],D()}catch{v("negative","Ocurrió un error al desactivar el usuario")}}async function _e(e){try{const a=await Be(e,I.value);v("positive","Usuario activado correctamente"),x.value=[],E.value=[],D()}catch{v("negative","Ocurrió un error al activar el usuario")}}async function be(){k.value=!0;try{const e=await Ne({name:f.value,tpdocument:_.value,numdocument:b.value,role:y.value,password:h.value},I.value);k.value=!1;let a=e.response.data.errors[0].msg;a==j.USEREXIST?v("negative","El usuario ya existe"):a==j.LENGTHPASSWORD?v("negative","La contraseña debe tener de 6 a 20 carácteres"):a==j.RULESPASSWORD?v("negative","La contraseña debe tener una letra mayúscula, una letra minúscula y un número"):(n.toggleModal(),x.value=[],v("positive","Usuario registrado correctamente"),D())}catch{v("negative","Ocurrió un error")}}const I=ee(()=>se.idSelected);return ke(I,()=>{D()}),Ee(()=>{D()}),(e,a)=>{const R=i("q-separator"),p=i("q-tab"),ye=i("q-tabs"),X=i("q-icon"),J=i("q-input"),F=i("q-btn"),K=i("q-btn-group"),Y=i("q-table"),Z=i("q-tab-panel"),ge=i("q-tab-panels"),he=i("q-card"),we=i("q-spinner-ios");return S(),te(De,null,[c("div",Me,[Pe,o(R,{class:"separator"}),c("div",Le,[o(Se,{onOnClick:de,label:"Crear nuevo usuario"}),c("div",Fe,[o(he,null,{default:u(()=>[o(ye,{modelValue:l(w),"onUpdate:modelValue":a[0]||(a[0]=t=>g(w)?w.value=t:w=t),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:u(()=>[o(p,{name:"active",label:"Activos"}),o(p,{name:"inactive",label:"Inactivos"})]),_:1},8,["modelValue"]),o(R),o(ge,{modelValue:l(w),"onUpdate:modelValue":a[3]||(a[3]=t=>g(w)?w.value=t:w=t),animated:""},{default:u(()=>[o(Z,{name:"active"},{default:u(()=>[o(Y,{flat:"",bordered:"",title:"Usuarios","row-key":"name",rows:x.value,columns:Q.value,filter:l(m),loading:U.value,"rows-per-page-options":[5,10,20]},{"top-right":u(()=>[o(J,{borderless:"",dense:"",debounce:"300",modelValue:l(m),"onUpdate:modelValue":a[1]||(a[1]=t=>g(m)?m.value=t:m=t),placeholder:"Buscar"},{append:u(()=>[o(X,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-Acciones":u(t=>[c("td",je,[o(K,{class:"full-width full-height",outline:"",square:""},{default:u(()=>[o(F,{icon:"edit_note","text-color":"blue-10",class:"col text-bold q-pa-none icon-table",onClick:$=>ve(t.row)},null,8,["onClick"]),t.row.role=="ADMIN"?(S(),V(F,{key:0,icon:"highlight_off","text-color":"blue-10",class:"col text-bold q-pa-none icon-table",onClick:$=>fe(t.row._id)},null,8,["onClick"])):O("",!0)]),_:2},1024)])]),_:1},8,["rows","columns","filter","loading"])]),_:1}),o(Z,{name:"inactive"},{default:u(()=>[o(Y,{flat:"",bordered:"",title:"Usuarios","row-key":"name",rows:E.value,columns:Q.value,filter:l(m),loading:U.value,"rows-per-page-options":[5,10,20]},{"top-right":u(()=>[o(J,{borderless:"",dense:"",debounce:"300",modelValue:l(m),"onUpdate:modelValue":a[2]||(a[2]=t=>g(m)?m.value=t:m=t),placeholder:"Buscar"},{append:u(()=>[o(X,{name:"search"})]),_:1},8,["modelValue"]),W("´ ")]),"body-cell-Acciones":u(t=>[c("td",We,[o(K,{class:"full-width full-height",outline:"",square:""},{default:u(()=>[o(F,{"text-color":"blue-10",class:"col q-pa-none",onClick:$=>_e(t.row._id)},{default:u(()=>[Ge]),_:2},1032,["onClick"])]),_:2},1024)])]),_:1},8,["rows","columns","filter","loading"])]),_:1})]),_:1},8,["modelValue"])]),_:1})])])]),l(n).modalIsOpen?(S(),V(Ae,{key:0,class:"modal"},{default:u(()=>[c("div",He,[c("h6",Qe,Ie(T.value),1),c("div",Xe,[c("div",Je,[o(ae,{label:"Nombre",type:"text",required:!0,ruless:C,value:l(M),modelValue:l(f),"onUpdate:modelValue":a[4]||(a[4]=t=>g(f)?f.value=t:f=t),onOnWrite:ne},null,8,["value","modelValue"]),c("div",Ke,[o(oe,{class:"q-pb-xs q-mb-md",type:"documents",label:"Tipo de documento",required:!0,ruless:C,value:l(P),modelValue:l(_),"onUpdate:modelValue":a[5]||(a[5]=t=>g(_)?_.value=t:_=t),onOnSelect:re},null,8,["value","modelValue"]),o(ae,{label:"Número documento",type:"number",required:!0,ruless:C,value:l(L),modelValue:l(b),"onUpdate:modelValue":a[6]||(a[6]=t=>g(b)?b.value=t:b=t),onOnWrite:ue},null,8,["value","modelValue"])]),l(A)!="SUPER"?(S(),V(oe,{key:0,class:"q-pb-xs q-mb-md",type:"roles",label:"Rol",required:!0,value:l(A),modelValue:l(y),"onUpdate:modelValue":a[7]||(a[7]=t=>g(y)?y.value=t:y=t),onOnSelect:ce},null,8,["value","modelValue"])):O("",!0),l(A)!="SUPER"?(S(),V(Oe,{key:1,label:"Contraseña",required:!0,ruless:C,modelValue:l(h),"onUpdate:modelValue":a[8]||(a[8]=t=>g(h)?h.value=t:h=t),onOnPassword:ie},null,8,["modelValue"])):O("",!0),Ye,c("div",Ze,[B.value?(S(),V(le,{key:0,disable:l(H),onOnClick:be},null,8,["disable"])):(S(),V(le,{key:1,disable:l(H),onOnClick:pe},null,8,["disable"]))]),k.value?(S(),te("div",$e,[o(we,{color:"primary",size:"2.5em"})])):O("",!0)])])])]),_:1})):O("",!0)],64)}}},ot=qe(et,[["__scopeId","data-v-cc86bb49"]]);export{ot as default};
