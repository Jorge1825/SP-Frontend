import{g as C,m as be,M as he,B as we,a as Z}from"./ModalForm-cb6eb8ec.js";import{x as R,_ as qe,l as Se,f as s,h as xe,m as Ve,r as c,o as q,c as $,a as i,d as o,w as u,i as l,g as x,j as A,F as Ue,q as h,v as j,t as ke,s as ee,A as te,C as Ee,p as Ae,e as De,R as L}from"./index-a0c708ca.js";const Ie=async()=>{try{const n=C(),{data:r}=await R.get("/users",{headers:{token:n}});return r}catch(n){return n}},Oe=async n=>{try{const r=C(),{data:d}=await R.post("/users/register",{name:n.name,tpdocument:n.tpdocument,numdocument:n.numdocument,role:n.role,password:n.password},{headers:{token:r}});return d}catch(r){return r}},Ce=async n=>{try{const r=C(),{data:d}=await R.put(`/users/inactive/${n}`,{},{headers:{token:r}});return d}catch(r){return r}},Re=async n=>{try{const r=C(),{data:d}=await R.put(`/users/active/${n}`,{},{headers:{token:r}});return d}catch(r){return r}};const F=n=>(Ae("data-v-008e0172"),n=n(),De(),n),Ne={class:"q-py-md table-container"},ze=F(()=>i("h6",{class:"title q-my-lg"},"ACCESO AL SISTEMA",-1)),Te={class:"container-content"},Be={class:"container-table q-mt-md q-pa-md",rounded:""},Me={style:{padding:"0px",margin:"0px","min-width":"100px","max-width":"20px"}},Pe={style:{padding:"0px",margin:"0px","min-width":"100px","max-width":"100px"}},Le=F(()=>i("i",{class:"icon icon-check"},null,-1)),je={class:"modalSystem"},Fe={class:"q-my-md text-center"},We={class:"row q-px-xl"},Ge={class:"col-12"},He={class:"row justify-between"},Qe=F(()=>i("span",{class:"text-required q-py-sm"},[j("Todos los campos con "),i("span",{class:"text-red"},"*"),j(" son obligatorios")],-1)),Xe={class:"row justify-center q-mt-sm"},Je={key:2,class:"spinner"},Ke={__name:"SystemView",setup(n){const r=Se(),d=be(),ae=s(),N=s(""),V=s(!1),U=s(!1),z=s(!0),S=s([]),k=s([]);let T=s(""),B=s(""),M=s(""),E=s(""),f=s(""),_=s(""),y=s(""),g=s(""),b=s(""),m=s(""),w=s("active");const W=xe(()=>!f.value||!_.value||!y.value||!g.value||!b.value?!0:U.value==!0),D=[e=>!!e||"Este campo es requerido"],G=s([{name:"id",label:"#",field:"id",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"Nombre",label:"Nombre",field:"name",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"Tipo",label:"Tipo",field:"tpdocument",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"Documento",label:"Documento",field:"numdocument",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"role",label:"Rol",field:"role",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"status",label:"Estado",field:"status",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"},{name:"Acciones",label:"Acciones",field:"acciones",align:"left",sortable:!0,headerStyle:"font-size: var(--font-large); font-weight: bold;",style:"font-size: var(--font-large);"}]),oe=e=>{f.value=e},le=e=>{_.value=e},se=e=>{y.value=e},ne=e=>{g.value=e},re=e=>{b.value=e},ue=e=>{N.value="REGISTRAR ACCESO",ie(),z.value=!0,d.toggleModal()},ie=()=>{T.value="",B.value="",M.value="",E.value="",f.value="",_.value="",y.value="",g.value="",b.value=""},ce=e=>{N.value="EDITAR TIPO DE PAGO",z.value=!1,ae.value=e._id,T.value=e.name,B.value=e.tpdocument,M.value=e.numdocument,E.value=e.role,f.value=e.name,_.value=e.tpdocument,y.value=e.numdocument,g.value=e.role,d.toggleModal()};async function de(){V.value=!0,U.value=!0,console.log(b.value)}async function I(){S.value=[],k.value=[],V.value=!0;try{const e=await Ie();let a=1,O=1;e.forEach(p=>{p.status=p.status?"Inactivo":"Activo",p.status=="Activo"?(p.id=a++,S.value.push(p)):(p.id=O++,k.value.push(p))}),V.value=!1}catch{v("negative","Ocurrió un error al obtener los usuarios")}}async function me(e){try{const a=await Ce(e);v("positive","Usuario desactivado correctamente"),S.value=[],k.value=[],I()}catch{v("negative","Ocurrió un error al desactivar el usuario")}}async function ve(e){try{const a=await Re(e);v("positive","Usuario activado correctamente"),S.value=[],k.value=[],I()}catch{v("negative","Ocurrió un error al activar el usuario")}}async function pe(){U.value=!0;try{const e=await Oe({name:f.value,tpdocument:_.value,numdocument:y.value,role:g.value,password:b.value});U.value=!1;let a=e.response.data.errors[0].msg;a==L.USEREXIST?v("negative","El usuario ya existe"):a==L.LENGTHPASSWORD?v("negative","La contraseña debe tener de 6 a 20 carácteres"):a==L.RULESPASSWORD?v("negative","La contraseña debe tener una letra mayúscula, una letra minúscula y un número"):(d.toggleModal(),S.value=[],v("positive","Usuario registrado correctamente"),I())}catch{v("negative","Ocurrió un error")}}function v(e,a){r.notify({type:e,message:a,position:"top"})}return Ve(()=>{I()}),(e,a)=>{const O=c("q-separator"),p=c("q-tab"),fe=c("q-tabs"),H=c("q-icon"),Q=c("q-input"),P=c("q-btn"),X=c("q-btn-group"),J=c("q-table"),K=c("q-tab-panel"),_e=c("q-tab-panels"),ye=c("q-card"),ge=c("q-spinner-ios");return q(),$(Ue,null,[i("div",Ne,[ze,o(O,{class:"separator"}),i("div",Te,[o(we,{onOnClick:ue,label:"Crear nuevo usuario"}),i("div",Be,[o(ye,null,{default:u(()=>[o(fe,{modelValue:l(w),"onUpdate:modelValue":a[0]||(a[0]=t=>h(w)?w.value=t:w=t),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:u(()=>[o(p,{name:"active",label:"Activos"}),o(p,{name:"inactive",label:"Inactivos"})]),_:1},8,["modelValue"]),o(O),o(_e,{modelValue:l(w),"onUpdate:modelValue":a[3]||(a[3]=t=>h(w)?w.value=t:w=t),animated:""},{default:u(()=>[o(K,{name:"active"},{default:u(()=>[o(J,{flat:"",bordered:"",title:"Usuarios","row-key":"name",rows:S.value,columns:G.value,filter:l(m),loading:V.value,"rows-per-page-options":[5,10,20]},{"top-right":u(()=>[o(Q,{borderless:"",dense:"",debounce:"300",modelValue:l(m),"onUpdate:modelValue":a[1]||(a[1]=t=>h(m)?m.value=t:m=t),placeholder:"Buscar"},{append:u(()=>[o(H,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-Acciones":u(t=>[i("td",Me,[o(X,{class:"full-width full-height",outline:"",square:""},{default:u(()=>[o(P,{icon:"edit_note","text-color":"blue-10",class:"col text-bold q-pa-none icon-table",onClick:Y=>ce(t.row)},null,8,["onClick"]),t.row.role=="ADMIN"?(q(),x(P,{key:0,icon:"highlight_off","text-color":"blue-10",class:"col text-bold q-pa-none icon-table",onClick:Y=>me(t.row._id)},null,8,["onClick"])):A("",!0)]),_:2},1024)])]),_:1},8,["rows","columns","filter","loading"])]),_:1}),o(K,{name:"inactive"},{default:u(()=>[o(J,{flat:"",bordered:"",title:"Usuarios","row-key":"name",rows:k.value,columns:G.value,filter:l(m),loading:V.value,"rows-per-page-options":[5,10,20]},{"top-right":u(()=>[o(Q,{borderless:"",dense:"",debounce:"300",modelValue:l(m),"onUpdate:modelValue":a[2]||(a[2]=t=>h(m)?m.value=t:m=t),placeholder:"Buscar"},{append:u(()=>[o(H,{name:"search"})]),_:1},8,["modelValue"]),j("´ ")]),"body-cell-Acciones":u(t=>[i("td",Pe,[o(X,{class:"full-width full-height",outline:"",square:""},{default:u(()=>[o(P,{"text-color":"blue-10",class:"col q-pa-none",onClick:Y=>ve(t.row._id)},{default:u(()=>[Le]),_:2},1032,["onClick"])]),_:2},1024)])]),_:1},8,["rows","columns","filter","loading"])]),_:1})]),_:1},8,["modelValue"])]),_:1})])])]),l(d).modalIsOpen?(q(),x(he,{key:0,class:"modal"},{default:u(()=>[i("div",je,[i("h6",Fe,ke(N.value),1),i("div",We,[i("div",Ge,[o(ee,{label:"Nombre",type:"text",required:!0,ruless:D,value:l(T),modelValue:l(f),"onUpdate:modelValue":a[4]||(a[4]=t=>h(f)?f.value=t:f=t),onOnWrite:oe},null,8,["value","modelValue"]),i("div",He,[o(te,{class:"q-pb-xs q-mb-md",type:"documents",label:"Tipo de documento",required:!0,ruless:D,value:l(B),modelValue:l(_),"onUpdate:modelValue":a[5]||(a[5]=t=>h(_)?_.value=t:_=t),onOnSelect:le},null,8,["value","modelValue"]),o(ee,{label:"Número documento",type:"number",required:!0,ruless:D,value:l(M),modelValue:l(y),"onUpdate:modelValue":a[6]||(a[6]=t=>h(y)?y.value=t:y=t),onOnWrite:se},null,8,["value","modelValue"])]),l(E)!="SUPER"?(q(),x(te,{key:0,class:"q-pb-xs q-mb-md",type:"roles",label:"Rol",required:!0,value:l(E),modelValue:l(g),"onUpdate:modelValue":a[7]||(a[7]=t=>h(g)?g.value=t:g=t),onOnSelect:ne},null,8,["value","modelValue"])):A("",!0),l(E)!="SUPER"?(q(),x(Ee,{key:1,label:"Contraseña",required:!0,ruless:D,modelValue:l(b),"onUpdate:modelValue":a[8]||(a[8]=t=>h(b)?b.value=t:b=t),onOnPassword:re},null,8,["modelValue"])):A("",!0),Qe,i("div",Xe,[z.value?(q(),x(Z,{key:0,disable:l(W),onOnClick:pe},null,8,["disable"])):(q(),x(Z,{key:1,disable:l(W),onOnClick:de},null,8,["disable"]))]),U.value?(q(),$("div",Je,[o(ge,{color:"primary",size:"2.5em"})])):A("",!0)])])])]),_:1})):A("",!0)],64)}}},$e=qe(Ke,[["__scopeId","data-v-008e0172"]]);export{$e as default};
